import{c as E,a as g,j as e,M as F,f as G,R as X}from"./index-zrOWfT8F.js";import{C as q}from"./chevron-down-_dFhnU8j.js";import{T as H,D as K}from"./trending-up-Dlo1Iyf6.js";import{B as J}from"./building-2-C9dQTGyB.js";const Q=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Z=E("briefcase",Q);const ee=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],te=E("chart-pie",ee);const ne=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],oe=E("refresh-ccw",ne),f=l=>Number(l||0).toLocaleString(),_=(l,i)=>{const o=String(i||"").trim();if(!o)return"-";if(!l)return o;const a=String(l).replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return o.replace(new RegExp(`^\\s*${a}\\s*년(?:도)?\\s*`),"").trim()||o};function fe({menuId:l,version:i,versions:o,orgs:a,entries:d,subjects:s,projects:j,user:S,onRefreshEntries:$}){const[V,B]=g.useState(new Date),[N,L]=g.useState(null),r=g.useMemo(()=>N?o.find(t=>t.id===N)||i:i||(o.length?o[0]:null),[i,o,N]),z=g.useMemo(()=>r?d.filter(t=>Number(t.year)===Number(r.year)&&Number(t.supplemental_round??0)===Number(r.round??0)):[],[d,r]),I=g.useMemo(()=>{const t={};return(s||[]).forEach(n=>{t[Number(n.id)]=n}),t},[s]),M=g.useMemo(()=>{const t={};return(a||[]).forEach(n=>{t[Number(n.id)]=n}),t},[a]),c=g.useMemo(()=>{let t=0,n=0;const x={},U=new Set((j||[]).map(p=>Number(p.id)));return z.forEach(p=>{const k=I[Number(p.subject)];if(!k)return;const C=Number(p.organization),Y=M[C]?.name||`부서#${C}`,b=Number(p.total_amount||0),w=String(k.subject_type||"").toLowerCase();x[C]||(x[C]={name:Y,income:0,expense:0,projectCount:new Set,laborCost:0,indirectCost:0,projectCost:0,entryCount:0});const m=x[C];m.entryCount++,w==="income"?(t+=b,m.income+=b):w==="expense"&&(n+=b,m.expense+=b);const u=(k.name||"").toLowerCase();u.includes("인건비")||u.includes("급여")||u.includes("보수")||u.includes("퇴직")||u.includes("상여")?m.laborCost+=b:u.includes("간접비")||u.includes("일반관리")||u.includes("경상")||u.includes("관리운영")?m.indirectCost+=b:w==="expense"&&(m.projectCost+=b),p.entrusted_project&&U.has(Number(p.entrusted_project))&&m.projectCount.add(Number(p.entrusted_project))}),Object.values(x).forEach(p=>{p.projectCount=p.projectCount.size}),{totalIncome:t,totalExpense:n,totalBudget:t+n,balance:t-n,totalEntries:z.length,totalDepts:Object.keys(x).length,totalProjects:(j||[]).length,deptStats:x}},[z,I,M,j]),h=g.useMemo(()=>Object.entries(c.deptStats).map(([t,n])=>({id:Number(t),...n})).sort((t,n)=>n.income+n.expense-(t.income+t.expense)),[c.deptStats]),R=h.reduce((t,n)=>t+n.laborCost,0),T=h.reduce((t,n)=>t+n.indirectCost,0),A=h.reduce((t,n)=>t+n.projectCost,0),D=h.reduce((t,n)=>t+n.projectCount,0),O=()=>{$(),B(new Date)},P=e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx("select",{value:r?.id||"",onChange:t=>L(Number(t.target.value)),style:{padding:"5px 28px 5px 10px",borderRadius:7,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:"12px",fontWeight:600,color:"#334155",appearance:"none",cursor:"pointer",minWidth:140},children:o.map(t=>e.jsxs("option",{value:t.id,children:[t.year,"년 / ",_(t.year,t.name)]},t.id))}),e.jsx(q,{size:12,style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",color:"#94a3b8",pointerEvents:"none"}})]}),e.jsxs("button",{onClick:O,style:{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",borderRadius:7,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:"12px",fontWeight:600,color:"#64748b",cursor:"pointer"},children:[e.jsx(oe,{size:12})," 새로고침"]}),r?.status&&e.jsx(re,{status:r.status})]});return e.jsx(F,{menuId:l,user:S,hideHero:!0,contextBadge:P,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsx(y,{icon:H,label:"총 수입",value:f(c.totalIncome),color:"#059669",bg:"#ecfdf5"}),e.jsx(y,{icon:K,label:"총 지출",value:f(c.totalExpense),color:"#dc2626",bg:"#fef2f2"}),e.jsx(y,{icon:te,label:"수지 차액",value:f(c.balance),color:c.balance>=0?"#059669":"#dc2626",bg:c.balance>=0?"#f0fdf4":"#fef2f2"}),e.jsx(y,{icon:G,label:"예산 항목",value:`${c.totalEntries}건`,color:"#2563eb",bg:"#eff6ff"}),e.jsx(y,{icon:J,label:"참여 부서",value:`${c.totalDepts}개`,color:"#7c3aed",bg:"#f5f3ff"}),e.jsx(y,{icon:Z,label:"수탁사업",value:`${D}개`,color:"#ea580c",bg:"#fff7ed"})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:"20px 24px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("h3",{style:{margin:"0 0 16px",fontSize:"15px",fontWeight:800,color:"#0f172a"},children:"조직 전체 비용 구성"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsx(W,{label:"인건비",amount:R,total:c.totalExpense,color:"#3b82f6"}),e.jsx(W,{label:"사업비(프로젝트)",amount:A,total:c.totalExpense,color:"#10b981"}),e.jsx(W,{label:"간접비(관리운영)",amount:T,total:c.totalExpense,color:"#f59e0b"})]})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:"15px",fontWeight:800,color:"#0f172a"},children:"부서별 예산 현황"}),e.jsxs("span",{style:{fontSize:"12px",color:"#94a3b8"},children:["마지막 갱신: ",V.toLocaleTimeString("ko-KR")]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc"},children:["부서명","편성 현황","수탁사업 수","수입","지출","인건비","사업비","간접비","항목 수"].map(t=>e.jsx("th",{style:{padding:"10px 16px",textAlign:t==="부서명"?"left":"right",fontSize:"11px",fontWeight:700,color:"#64748b",borderBottom:"2px solid #e2e8f0",whiteSpace:"nowrap",letterSpacing:"0.04em"},children:t},t))})}),e.jsxs("tbody",{children:[h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:32,textAlign:"center",color:"#94a3b8",fontSize:"13px"},children:"데이터가 없습니다."})}):h.map((t,n)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",background:n%2===0?"#fff":"#fafbfc"},onMouseOver:x=>x.currentTarget.style.background="#f0f4ff",onMouseOut:x=>x.currentTarget.style.background=n%2===0?"#fff":"#fafbfc",children:[e.jsx("td",{style:{padding:"10px 16px",fontWeight:700,color:"#1e293b",fontSize:"13px"},children:t.name}),e.jsx("td",{style:{padding:"8px 16px",minWidth:160},children:e.jsx(ie,{entries:z,orgId:t.id})}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#ea580c",fontWeight:700},children:t.projectCount}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#059669",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.income)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#dc2626",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.expense)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#3b82f6",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.laborCost)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#10b981",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.projectCost)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#f59e0b",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.indirectCost)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#64748b"},children:t.entryCount})]},t.id)),h.length>0&&e.jsxs("tr",{style:{background:"#f0f4ff",borderTop:"2px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"10px 16px",fontWeight:800,color:"#0f172a",fontSize:"13px"},children:"합계"}),e.jsx("td",{style:{padding:"10px 16px"}}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#ea580c"},children:D}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#059669",fontVariantNumeric:"tabular-nums"},children:f(c.totalIncome)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#dc2626",fontVariantNumeric:"tabular-nums"},children:f(c.totalExpense)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#3b82f6",fontVariantNumeric:"tabular-nums"},children:f(R)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#10b981",fontVariantNumeric:"tabular-nums"},children:f(A)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#f59e0b",fontVariantNumeric:"tabular-nums"},children:f(T)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#64748b"},children:c.totalEntries})]})]})]})})]}),r&&e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:"20px 24px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("h3",{style:{margin:"0 0 12px",fontSize:"15px",fontWeight:800,color:"#0f172a"},children:"예산서 정보"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[e.jsx(v,{label:"연도",value:`${r.year}년`}),e.jsx(v,{label:"예산명",value:_(r.year,r.name)}),e.jsx(v,{label:"상태",value:r.status==="PENDING"?"접수중":r.status==="CLOSED"?"마감":r.status==="CONFIRMED"?"확정":r.status||"-"}),e.jsx(v,{label:"입력 기간",value:r.start_date&&r.end_date?`${r.start_date} ~ ${r.end_date}`:"미지정"}),e.jsx(v,{label:"회차",value:`${r.round??0} 차`})]})]})]})})}function y({icon:l,label:i,value:o,color:a,bg:d}){return e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:12,padding:"16px 20px",display:"flex",alignItems:"center",gap:14,boxShadow:"0 1px 3px rgba(0,0,0,0.04)",transition:"transform 0.15s, box-shadow 0.15s"},onMouseOver:s=>{s.currentTarget.style.transform="translateY(-1px)",s.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.08)"},onMouseOut:s=>{s.currentTarget.style.transform="none",s.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:d,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:X.createElement(l,{size:20,style:{color:a}})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:600,color:"#94a3b8",letterSpacing:"0.04em"},children:i}),e.jsx("div",{style:{fontSize:"18px",fontWeight:800,color:"#0f172a",fontVariantNumeric:"tabular-nums",marginTop:2},children:o})]})]})}function W({label:l,amount:i,total:o,color:a}){const d=o>0?Math.round(i/o*100):0;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:6},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:"#1e293b"},children:l}),e.jsxs("span",{style:{fontSize:"12px",fontWeight:600,color:"#64748b"},children:[f(i)," ",e.jsxs("span",{style:{color:"#94a3b8",fontSize:"11px"},children:["(",d,"%)"]})]})]}),e.jsx("div",{style:{height:8,borderRadius:999,background:"#f1f5f9",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:999,background:a,width:`${d}%`,transition:"width 0.4s ease"}})})]})}function v({label:l,value:i}){return e.jsxs("div",{style:{padding:"10px 14px",background:"#f8fafc",borderRadius:8,border:"1px solid #f1f5f9"},children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:600,color:"#94a3b8",marginBottom:4},children:l}),e.jsx("div",{style:{fontSize:"14px",fontWeight:700,color:"#1e293b"},children:i})]})}function re({status:l}){const i=String(l||"").toUpperCase();let o="대기중",a="#f1f5f9",d="#64748b",s="#e2e8f0";return i==="PENDING"?(o="접수중",a="#eff6ff",d="#1d4ed8",s="#bfdbfe"):i==="EXPIRED"?(o="접수마감",a="#fff7ed",d="#c2410c",s="#fed7aa"):i==="CLOSED"?(o="마감",a="#f1f5f9",d="#64748b",s="#cbd5e1"):i==="CONFIRMED"&&(o="확정",a="#ecfdf5",d="#065f46",s="#a7f3d0"),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:5,fontSize:"12px",fontWeight:700,padding:"5px 10px",borderRadius:7,background:a,color:d,border:`1px solid ${s}`,marginTop:0},children:o})}function ie({entries:l,orgId:i}){const o=l.filter(S=>Number(S.organization)===Number(i)),a=o.length;if(a===0)return e.jsx("span",{style:{fontSize:11,color:"#94a3b8"},children:"항목 없음"});const d=o.filter(S=>Number(S.total_amount||0)>0).length,s=Math.round(d/a*100),j=s===100?"#10b981":s>=50?"#3b82f6":"#f59e0b";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{flex:1,height:7,borderRadius:999,background:"#f1f5f9",overflow:"hidden",minWidth:80},children:e.jsx("div",{style:{height:"100%",borderRadius:999,background:j,width:`${s}%`,transition:"width 0.4s ease"}})}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,color:j,minWidth:32,textAlign:"right"},children:[s,"%"]})]})}export{fe as default};
