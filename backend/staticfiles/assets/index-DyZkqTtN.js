import{c as M,a as b,j as e,M as H,f as U,R as Y}from"./index-jKD0RYeX.js";import{C as q}from"./chevron-down-L0iaQFOE.js";import{T as F,D as G}from"./trending-up-C-5suz34.js";import{B as K}from"./building-2-CrANde-B.js";const X=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],J=M("briefcase",X);const Q=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Z=M("chart-pie",Q);const ee=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],te=M("refresh-ccw",ee),f=c=>Number(c||0).toLocaleString();function de({menuId:c,version:l,versions:s,orgs:r,entries:a,subjects:i,projects:p,user:x,onRefreshEntries:_}){const[A,V]=b.useState(new Date),[w,B]=b.useState(null),o=b.useMemo(()=>w?s.find(t=>t.id===w)||l:l||(s.length?s[0]:null),[l,s,w]),C=b.useMemo(()=>o?a.filter(t=>Number(t.year)===Number(o.year)&&Number(t.supplemental_round??0)===Number(o.round??0)):[],[a,o]),I=b.useMemo(()=>{const t={};return(i||[]).forEach(n=>{t[Number(n.id)]=n}),t},[i]),E=b.useMemo(()=>{const t={};return(r||[]).forEach(n=>{t[Number(n.id)]=n}),t},[r]),d=b.useMemo(()=>{let t=0,n=0;const g={},O=new Set((p||[]).map(u=>Number(u.id)));return C.forEach(u=>{const N=I[Number(u.subject)];if(!N)return;const v=Number(u.organization),P=E[v]?.name||`부서#${v}`,j=Number(u.total_amount||0),W=String(N.subject_type||"").toLowerCase();g[v]||(g[v]={name:P,income:0,expense:0,projectCount:new Set,laborCost:0,indirectCost:0,projectCost:0,entryCount:0});const y=g[v];y.entryCount++,W==="income"?(t+=j,y.income+=j):W==="expense"&&(n+=j,y.expense+=j);const h=(N.name||"").toLowerCase();h.includes("인건비")||h.includes("급여")||h.includes("보수")||h.includes("퇴직")||h.includes("상여")?y.laborCost+=j:h.includes("간접비")||h.includes("일반관리")||h.includes("경상")||h.includes("관리운영")?y.indirectCost+=j:W==="expense"&&(y.projectCost+=j),u.entrusted_project&&O.has(Number(u.entrusted_project))&&y.projectCount.add(Number(u.entrusted_project))}),Object.values(g).forEach(u=>{u.projectCount=u.projectCount.size}),{totalIncome:t,totalExpense:n,totalBudget:t+n,balance:t-n,totalEntries:C.length,totalDepts:Object.keys(g).length,totalProjects:(p||[]).length,deptStats:g}},[C,I,E,p]),m=b.useMemo(()=>Object.entries(d.deptStats).map(([t,n])=>({id:Number(t),...n})).sort((t,n)=>n.income+n.expense-(t.income+t.expense)),[d.deptStats]),$=m.reduce((t,n)=>t+n.laborCost,0),D=m.reduce((t,n)=>t+n.indirectCost,0),R=m.reduce((t,n)=>t+n.projectCost,0),T=m.reduce((t,n)=>t+n.projectCount,0),L=()=>{_(),V(new Date)};return e.jsx(H,{menuId:c,user:x,hideHero:!0,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:800,color:"#0f172a"},children:"예산 현황 대시보드"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b"},children:[o?`${o.year}년 ${o.name}`:"버전 미선택"," 기준 통계"]}),o?.end_date&&e.jsx(ne,{endDate:o.end_date})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx("select",{value:o?.id||"",onChange:t=>B(Number(t.target.value)),style:{padding:"8px 32px 8px 12px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",fontSize:"13px",fontWeight:600,color:"#334155",appearance:"none",cursor:"pointer",minWidth:160},children:s.map(t=>e.jsxs("option",{value:t.id,children:[t.year,"년 ",t.name]},t.id))}),e.jsx(q,{size:14,style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",color:"#94a3b8",pointerEvents:"none"}})]}),e.jsxs("button",{onClick:L,style:{display:"flex",alignItems:"center",gap:6,padding:"8px 14px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",fontSize:"13px",fontWeight:600,color:"#64748b",cursor:"pointer"},children:[e.jsx(te,{size:14})," 새로고침"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsx(S,{icon:F,label:"총 수입",value:f(d.totalIncome),color:"#059669",bg:"#ecfdf5"}),e.jsx(S,{icon:G,label:"총 지출",value:f(d.totalExpense),color:"#dc2626",bg:"#fef2f2"}),e.jsx(S,{icon:Z,label:"수지 차액",value:f(d.balance),color:d.balance>=0?"#059669":"#dc2626",bg:d.balance>=0?"#f0fdf4":"#fef2f2"}),e.jsx(S,{icon:U,label:"예산 항목",value:`${d.totalEntries}건`,color:"#2563eb",bg:"#eff6ff"}),e.jsx(S,{icon:K,label:"참여 부서",value:`${d.totalDepts}개`,color:"#7c3aed",bg:"#f5f3ff"}),e.jsx(S,{icon:J,label:"수탁사업",value:`${T}개`,color:"#ea580c",bg:"#fff7ed"})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:"20px 24px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("h3",{style:{margin:"0 0 16px",fontSize:"15px",fontWeight:800,color:"#0f172a"},children:"조직 전체 비용 구성"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsx(k,{label:"인건비",amount:$,total:d.totalExpense,color:"#3b82f6"}),e.jsx(k,{label:"사업비(프로젝트)",amount:R,total:d.totalExpense,color:"#10b981"}),e.jsx(k,{label:"간접비(관리운영)",amount:D,total:d.totalExpense,color:"#f59e0b"})]})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:"15px",fontWeight:800,color:"#0f172a"},children:"부서별 예산 현황"}),e.jsxs("span",{style:{fontSize:"12px",color:"#94a3b8"},children:["마지막 갱신: ",A.toLocaleTimeString("ko-KR")]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc"},children:["부서명","편성 현황","수탁사업 수","수입","지출","인건비","사업비","간접비","항목 수"].map(t=>e.jsx("th",{style:{padding:"10px 16px",textAlign:t==="부서명"?"left":"right",fontSize:"11px",fontWeight:700,color:"#64748b",borderBottom:"2px solid #e2e8f0",whiteSpace:"nowrap",letterSpacing:"0.04em"},children:t},t))})}),e.jsxs("tbody",{children:[m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:32,textAlign:"center",color:"#94a3b8",fontSize:"13px"},children:"데이터가 없습니다."})}):m.map((t,n)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",background:n%2===0?"#fff":"#fafbfc"},onMouseOver:g=>g.currentTarget.style.background="#f0f4ff",onMouseOut:g=>g.currentTarget.style.background=n%2===0?"#fff":"#fafbfc",children:[e.jsx("td",{style:{padding:"10px 16px",fontWeight:700,color:"#1e293b",fontSize:"13px"},children:t.name}),e.jsx("td",{style:{padding:"8px 16px",minWidth:160},children:e.jsx(oe,{entries:C,orgId:t.id})}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#ea580c",fontWeight:700},children:t.projectCount}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#059669",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.income)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#dc2626",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.expense)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#3b82f6",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.laborCost)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#10b981",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.projectCost)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#f59e0b",fontWeight:600,fontVariantNumeric:"tabular-nums"},children:f(t.indirectCost)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontSize:"13px",color:"#64748b"},children:t.entryCount})]},t.id)),m.length>0&&e.jsxs("tr",{style:{background:"#f0f4ff",borderTop:"2px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"10px 16px",fontWeight:800,color:"#0f172a",fontSize:"13px"},children:"합계"}),e.jsx("td",{style:{padding:"10px 16px"}}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#ea580c"},children:T}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#059669",fontVariantNumeric:"tabular-nums"},children:f(d.totalIncome)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#dc2626",fontVariantNumeric:"tabular-nums"},children:f(d.totalExpense)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#3b82f6",fontVariantNumeric:"tabular-nums"},children:f($)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#10b981",fontVariantNumeric:"tabular-nums"},children:f(R)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#f59e0b",fontVariantNumeric:"tabular-nums"},children:f(D)}),e.jsx("td",{style:{padding:"10px 16px",textAlign:"right",fontWeight:800,fontSize:"13px",color:"#64748b"},children:d.totalEntries})]})]})]})})]}),o&&e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:"20px 24px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("h3",{style:{margin:"0 0 12px",fontSize:"15px",fontWeight:800,color:"#0f172a"},children:"예산서 정보"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[e.jsx(z,{label:"예산명",value:`${o.year}년 ${o.name}`}),e.jsx(z,{label:"상태",value:o.status==="PENDING"?"접수중":o.status==="CLOSED"?"마감":o.status==="CONFIRMED"?"확정":o.status||"-"}),e.jsx(z,{label:"입력 기간",value:o.start_date&&o.end_date?`${o.start_date} ~ ${o.end_date}`:"미지정"}),e.jsx(z,{label:"회차",value:`${o.round??0} 차`})]})]})]})})}function S({icon:c,label:l,value:s,color:r,bg:a}){return e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:12,padding:"16px 20px",display:"flex",alignItems:"center",gap:14,boxShadow:"0 1px 3px rgba(0,0,0,0.04)",transition:"transform 0.15s, box-shadow 0.15s"},onMouseOver:i=>{i.currentTarget.style.transform="translateY(-1px)",i.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.08)"},onMouseOut:i=>{i.currentTarget.style.transform="none",i.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:Y.createElement(c,{size:20,style:{color:r}})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:600,color:"#94a3b8",letterSpacing:"0.04em"},children:l}),e.jsx("div",{style:{fontSize:"18px",fontWeight:800,color:"#0f172a",fontVariantNumeric:"tabular-nums",marginTop:2},children:s})]})]})}function k({label:c,amount:l,total:s,color:r}){const a=s>0?Math.round(l/s*100):0;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:6},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:"#1e293b"},children:c}),e.jsxs("span",{style:{fontSize:"12px",fontWeight:600,color:"#64748b"},children:[f(l)," ",e.jsxs("span",{style:{color:"#94a3b8",fontSize:"11px"},children:["(",a,"%)"]})]})]}),e.jsx("div",{style:{height:8,borderRadius:999,background:"#f1f5f9",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:999,background:r,width:`${a}%`,transition:"width 0.4s ease"}})})]})}function z({label:c,value:l}){return e.jsxs("div",{style:{padding:"10px 14px",background:"#f8fafc",borderRadius:8,border:"1px solid #f1f5f9"},children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:600,color:"#94a3b8",marginBottom:4},children:c}),e.jsx("div",{style:{fontSize:"14px",fontWeight:700,color:"#1e293b"},children:l})]})}function ne({endDate:c}){const l=new Date;l.setHours(0,0,0,0);const s=new Date(c);s.setHours(0,0,0,0);const r=Math.round((s-l)/(1e3*60*60*24));let a,i,p,x;return r<0?(a="마감 완료",i="#f1f5f9",p="#94a3b8",x="#e2e8f0"):r===0?(a="D-day · 오늘 마감",i="#fef2f2",p="#dc2626",x="#fca5a5"):r<=3?(a=`D-${r} · ${r}일 남음`,i="#fff7ed",p="#ea580c",x="#fed7aa"):r<=7?(a=`D-${r} · ${r}일 남음`,i="#fefce8",p="#ca8a04",x="#fde68a"):(a=`D-${r} · ${r}일 남음`,i="#f0fdf4",p="#16a34a",x="#86efac"),e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:5,fontSize:"12px",fontWeight:700,padding:"3px 10px",borderRadius:999,background:i,color:p,border:`1px solid ${x}`,marginTop:6},children:["⏱ 입력 마감: ",c," · ",a]})}function oe({entries:c,orgId:l}){const s=c.filter(x=>Number(x.organization)===Number(l)),r=s.length;if(r===0)return e.jsx("span",{style:{fontSize:11,color:"#94a3b8"},children:"항목 없음"});const a=s.filter(x=>Number(x.total_amount||0)>0).length,i=Math.round(a/r*100),p=i===100?"#10b981":i>=50?"#3b82f6":"#f59e0b";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{flex:1,height:7,borderRadius:999,background:"#f1f5f9",overflow:"hidden",minWidth:80},children:e.jsx("div",{style:{height:"100%",borderRadius:999,background:p,width:`${i}%`,transition:"width 0.4s ease"}})}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,color:p,minWidth:32,textAlign:"right"},children:[i,"%"]})]})}export{de as default};
