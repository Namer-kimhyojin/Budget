import{a as n,t as S,h as x,j as e,M as T,m as k}from"./index-w09qMJmz.js";const{menuPanelCard:f,menuPanelHead:b,menuPanelBody:w,simpleTextarea:D,simpleTable:E,simpleTh:i,simpleTd:c,menuGhostBtn:M}=k;function I({menuId:m,authAxios:r,user:a,modalApi:s}){const[d,j]=n.useState(""),[o,g]=n.useState([]),[p,u]=n.useState(!1),l=n.useCallback(async()=>{u(!0);try{const t=await r.get("/api/notifications/"),h=S(t.data).filter(y=>Number(y.user)===Number(a?.id)).sort((y,N)=>new Date(N.created_at)-new Date(y.created_at));g(h)}catch(t){await s.alert(x(t,"공지/알림 목록을 불러오지 못했습니다."))}finally{u(!1)}},[r,a,s]);n.useEffect(()=>{l()},[l]);const _=async()=>{if(!d.trim())return s.alert("공지 내용을 입력해주세요.");try{await r.post("/api/notifications/",{user:a.id,message:d.trim(),is_read:!1}),j(""),await l(),await s.alert("공지(알림)가 등록되었습니다.")}catch(t){await s.alert(x(t,"공지 등록에 실패했습니다."))}},v=async t=>{try{await r.patch(`/api/notifications/${t.id}/`,{is_read:!0}),await l()}catch(h){await s.alert(x(h,"읽음 처리에 실패했습니다."))}},C=o.filter(t=>!t.is_read).length;return e.jsxs(T,{menuId:m,user:a,actions:[{label:"알림 새로고침",onClick:l,disabled:p},{label:"공지 등록",onClick:_,disabled:a?.role!=="ADMIN"}],stats:[{label:"전체 알림",value:`${o.length}건`},{label:"미읽음",value:`${C}건`}],children:[e.jsxs("section",{style:f,children:[e.jsx("div",{style:b,children:"확정 공지 등록(기본)"}),e.jsx("div",{style:w,children:e.jsx("textarea",{style:D,rows:4,value:d,onChange:t=>j(t.target.value),placeholder:"예: 2026년 본예산이 최종 확정되었습니다."})})]}),e.jsxs("section",{style:f,children:[e.jsx("div",{style:b,children:"내 공지/알림 이력"}),e.jsx("div",{style:w,children:e.jsxs("table",{style:E,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:i,children:"일시"}),e.jsx("th",{style:i,children:"내용"}),e.jsx("th",{style:i,children:"상태"}),e.jsx("th",{style:i,children:"작업"})]})}),e.jsx("tbody",{children:o.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:c,children:t.created_at?new Date(t.created_at).toLocaleString():"-"}),e.jsx("td",{style:c,children:t.message}),e.jsx("td",{style:c,children:t.is_read?"읽음":"미읽음"}),e.jsx("td",{style:c,children:!t.is_read&&e.jsx("button",{style:M,type:"button",onClick:()=>v(t),children:"읽음 처리"})})]},t.id))})]})})]})]})}export{I as default};
