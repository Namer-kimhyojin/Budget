import{c as V,j as e,a as d,L as Ve,m as fe,f as ye,S as qe,e as He,g as Ye,R as we,M as Ke,h as G}from"./index-DjIp5sBl.js";import{C as Re,a as Xe,E as Te,D as me,L as Ze,b as Je,P as Qe}from"./paperclip-_t1e2lo1.js";import{F as pe,P as Ee,T as et}from"./triangle-alert-CzDmATY1.js";import{P as De}from"./pen-Du7Fvvbv.js";import{T as ue}from"./trash-2-Cx0R4Gar.js";import{S as tt}from"./StatusBadge-DP37_0SN.js";import{D as nt,T as ot}from"./trending-up-DsnxH8wx.js";import{C as it}from"./chevron-down-BvLVb4UR.js";const st=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rt=V("arrow-left",st);const lt=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],at=V("arrow-up-down",lt);const dt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ie=V("calendar",dt);const ct=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],ze=V("circle-pause",ct);const ft=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ne=V("circle-play",ft);const pt=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],ut=V("hash",pt);const xt=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],gt=V("layout-grid",xt);const ht=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],bt=V("list",ht);function je({isOpen:t,onClose:i,title:o,children:S,footer:f,width:_=500}){return t?e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:20},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:16,width:"100%",maxWidth:_,boxShadow:"0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04)",display:"flex",flexDirection:"column",maxHeight:"90vh"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:800,color:"#0f172a"},children:o}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#94a3b8",lineHeight:1},children:"×"})]}),e.jsx("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:S}),f&&e.jsx("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",gap:12,backgroundColor:"#f8fafc",borderBottomLeftRadius:16,borderBottomRightRadius:16},children:f})]})}):null}const{simpleSelect:yt}=fe,ie={DRAFT:{label:"대기중",color:"#64748b",bg:"#f1f5f9",border:"#e2e8f0",dot:"#94a3b8"},PENDING:{label:"접수중",color:"#1d4ed8",bg:"#eff6ff",border:"#bfdbfe",dot:"#3b82f6"},EXPIRED:{label:"접수마감",color:"#c2410c",bg:"#ffedd5",border:"#fdba74",dot:"#f97316"},CONFIRMED:{label:"확정",color:"#065f46",bg:"#ecfdf5",border:"#a7f3d0",dot:"#10b981"},CLOSED:{label:"마감",color:"#92400e",bg:"#fffbeb",border:"#fde68a",dot:"#f59e0b"}},Se={DRAFT:1,PENDING:2,EXPIRED:3,CONFIRMED:4,CLOSED:5},ke=t=>["PENDING","DRAFT","EXPIRED"].includes(String(t||"").toUpperCase()),Z=t=>{if(!t)return 0;const i=new Date(t).getTime();return Number.isFinite(i)?i:0};function ae(t,i){const o=ke(t.status)?1:0,S=ke(i.status)?1:0;return S!==o?S-o:i.year!==t.year?i.year-t.year:(i.round||0)!==(t.round||0)?(i.round||0)-(t.round||0):String(t.id).localeCompare(String(i.id))}function ce(t){if(!t)return null;const i=new Date(t);i.setHours(23,59,59,999);const o=Math.ceil((i-Date.now())/864e5);return o===0?{label:"D-Day",color:"#dc2626",bg:"#fef2f2",border:"#fca5a5"}:o>0&&o<=3?{label:`D-${o}`,color:"#ea580c",bg:"#fff7ed",border:"#fed7aa"}:o>0&&o<=7?{label:`D-${o}`,color:"#ca8a04",bg:"#fefce8",border:"#fde68a"}:o>0?{label:`D-${o}`,color:"#16a34a",bg:"#f0fdf4",border:"#bbf7d0"}:{label:`D+${Math.abs(o)}`,color:"#94a3b8",bg:"#f1f5f9",border:"#e2e8f0"}}function mt({item:t,rank:i,canManage:o,handleGoDetail:S,setVersion:f,setIsEditModalOpen:_,handleCloseVersion:M,handleReopenVersion:h,handleDeleteVersion:B,progressData:N,summaryVersionId:b}){const l=t.status==="PENDING"||t.status==="DRAFT"||t.status==="EXPIRED",p=t.status==="CLOSED",c=ie[t.status]||ie.DRAFT,E=ce(t.end_date),R=d.useMemo(()=>{if(!N?.length||b!==t.id)return null;const W=N.length;if(!W)return null;const P=N.filter($=>$.dept_status==="COMPLETED").length,L=N.filter($=>["WRITING","SUBMITTED"].includes($.dept_status)).length;return{total:W,completed:P,inProgress:L,pct:Math.round(P/W*100)}},[N,b,t.id]);return e.jsxs("div",{style:{background:"#fff",borderRadius:16,border:l?`2px solid ${c.border}`:"1px solid #e2e8f0",boxShadow:l?"0 4px 20px rgba(37,99,235,0.10), 0 1px 4px rgba(0,0,0,0.04)":"0 1px 4px rgba(0,0,0,0.04)",display:"flex",flexDirection:"column",overflow:"hidden",transition:"box-shadow 0.2s, transform 0.2s",opacity:p?.72:1,position:"relative"},onMouseEnter:W=>{W.currentTarget.style.boxShadow="0 8px 30px rgba(0,0,0,0.10)",W.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:W=>{W.currentTarget.style.boxShadow=l?"0 4px 20px rgba(37,99,235,0.10)":"0 1px 4px rgba(0,0,0,0.04)",W.currentTarget.style.transform="none"},children:[e.jsx("div",{style:{height:4,background:l?"linear-gradient(90deg, #2563eb, #60a5fa)":c.dot,borderRadius:"16px 16px 0 0"}}),e.jsxs("div",{style:{padding:"18px 20px",flex:1,display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700,color:"#94a3b8",letterSpacing:"0.06em",marginBottom:2},children:[t.year,"년도 · ",i,"번째 예산"]}),e.jsx("div",{style:{fontSize:17,fontWeight:900,color:"#0f172a",lineHeight:1.2},children:t.name})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4,flexShrink:0},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:11,fontWeight:700,padding:"3px 9px",borderRadius:999,background:c.bg,color:c.color,border:`1px solid ${c.border}`},children:[e.jsx("span",{style:{width:6,height:6,borderRadius:"50%",background:c.dot,display:"inline-block"}}),c.label]}),l&&E&&e.jsx("span",{style:{fontSize:11,fontWeight:800,padding:"2px 8px",borderRadius:999,background:E.bg,color:E.color,border:`1px solid ${E.border}`},children:E.label})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#64748b"},children:[e.jsx(Ie,{size:13,style:{flexShrink:0}}),t.start_date?e.jsxs("span",{children:[e.jsx("b",{style:{color:"#334155"},children:t.start_date})," ~ ",e.jsx("b",{style:{color:"#334155"},children:t.end_date})]}):e.jsx("span",{style:{color:"#cbd5e1"},children:"기간 미설정"})]}),t.guidelines&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,color:"#2563eb",background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:6,padding:"4px 10px",alignSelf:"flex-start"},children:[e.jsx(pe,{size:11})," 작성 지침 있음"]}),R&&e.jsxs("div",{style:{marginTop:2},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#64748b",marginBottom:5},children:[e.jsx("span",{children:"부서 편성 현황"}),e.jsxs("span",{style:{fontWeight:800,color:R.pct===100?"#059669":"#2563eb"},children:[R.completed,"/",R.total," (",R.pct,"%)"]})]}),e.jsx("div",{style:{height:6,borderRadius:99,background:"#f1f5f9",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:R.pct===100?"linear-gradient(90deg,#10b981,#059669)":"linear-gradient(90deg,#60a5fa,#2563eb)",width:`${R.pct}%`,transition:"width 0.5s ease"}})}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:5,fontSize:11},children:[e.jsxs("span",{style:{color:"#059669",fontWeight:700},children:["✓ 완료 ",R.completed]}),e.jsxs("span",{style:{color:"#d97706",fontWeight:700},children:["⏳ 진행 ",R.inProgress]}),e.jsxs("span",{style:{color:"#94a3b8"},children:["○ 미시작 ",R.total-R.completed-R.inProgress]})]})]})]}),e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",padding:"10px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,background:"#fafbfc"},children:[e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{display:"flex",gap:4,flexShrink:0},children:[e.jsx(U,{title:"상세 보기",color:"#2563eb",bg:"#eff6ff",onClick:()=>S(t),children:e.jsx(Te,{size:13})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"수정",color:"#0369a1",bg:"#f0f9ff",onClick:()=>{f(t),_(!0)},children:e.jsx(De,{size:13})}),p?e.jsx(U,{title:"마감 해제",color:"#059669",bg:"#ecfdf5",onClick:()=>h(t),children:e.jsx(Ne,{size:13})}):e.jsx(U,{title:"회차 마감",color:"#b45309",bg:"#fffbeb",onClick:()=>M(t),children:e.jsx(ze,{size:13})}),e.jsx(U,{title:"삭제",color:"#dc2626",bg:"#fef2f2",onClick:()=>B(t),children:e.jsx(ue,{size:13})})]})]})]})]})}function U({children:t,title:i,color:o,bg:S,onClick:f}){const[_,M]=d.useState(!1);return e.jsx("button",{title:i,onClick:f,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),style:{width:30,height:30,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${_?o:"#e2e8f0"}`,borderRadius:8,background:_?S:"#fff",color:_?o:"#64748b",cursor:"pointer",transition:"all 0.15s"},children:t})}function jt({versions:t,setVersion:i,canManage:o,statusById:S,handleGoDetail:f,setIsEditModalOpen:_,handleCloseVersion:M,handleReopenVersion:h,handleDeleteVersion:B,setIsCreateModalOpen:N,progressData:b=[],summaryVersionId:l}){const p=d.useMemo(()=>t.find(r=>r.id===l)||t.find(r=>r.status==="PENDING")||t.find(r=>r.status==="DRAFT")||null,[t,l]),c=p?ce(p.end_date):null,E=d.useMemo(()=>{if(!b.length)return{completed:0,inProgress:0,notStarted:0,total:0};const r=b.filter(u=>u.dept_status==="COMPLETED").length,g=b.filter(u=>["WRITING","SUBMITTED"].includes(u.dept_status)).length,j=b.filter(u=>["NOT_STARTED","EMPTY"].includes(u.dept_status)).length;return{completed:r,inProgress:g,notStarted:j,total:b.length}},[b]),R=d.useMemo(()=>{const r={DRAFT:0,PENDING:0,CONFIRMED:0,CLOSED:0};return t.forEach(g=>{const j=String(S[g.id]||g.status||"").toUpperCase();r[j]!==void 0&&r[j]++}),{total:t.length,...r}},[t,S]),W=d.useMemo(()=>b.reduce((r,g)=>r+Number(g.total_entries||0),0),[b]),P=d.useMemo(()=>b.reduce((r,g)=>r+Number(g.total_amount||0),0),[b]),[L,$]=d.useState("card"),[A,y]=d.useState("active_year"),[a,m]=d.useState("desc"),k=[{value:"active_year",label:"기본(활성/연도)"},{value:"year",label:"연도"},{value:"round",label:"회차"},{value:"name",label:"예산명"},{value:"status",label:"상태"},{value:"start_date",label:"시작일"},{value:"end_date",label:"종료일"},{value:"created_at",label:"생성일"}],w=()=>m(r=>r==="asc"?"desc":"asc"),z=r=>{if(A===r){w();return}y(r),m("desc")},I=r=>A===r?a==="asc"?" ^":" v":" -",v=d.useMemo(()=>{const r=[...t];return r.sort((g,j)=>{let u=0;if(A==="active_year")return u=ae(g,j),a==="asc"?-u:u;switch(A){case"year":u=Number(g.year||0)-Number(j.year||0);break;case"round":u=Number(g.round||0)-Number(j.round||0);break;case"name":u=String(g.name||"").localeCompare(String(j.name||""),"ko");break;case"status":u=Number(Se[g.status]||99)-Number(Se[j.status]||99);break;case"start_date":u=Z(g.start_date)-Z(j.start_date);break;case"end_date":u=Z(g.end_date)-Z(j.end_date);break;case"created_at":u=Z(g.created_at)-Z(j.created_at);break;default:return u=ae(g,j),a==="asc"?-u:u}return u===0&&(u=ae(g,j)),a==="asc"?u:-u}),r},[t,a,A]),F=d.useMemo(()=>{const r={},g={};return t.forEach(j=>{g[j.year]||(g[j.year]=[]),g[j.year].push(j)}),Object.keys(g).forEach(j=>{g[j].sort((u,q)=>(u.round||0)-(q.round||0)||String(u.id).localeCompare(String(q.id))),g[j].forEach((u,q)=>r[u.id]=q+1)}),r},[t]),C={textAlign:"left",borderBottom:"1px solid #e2e8f0",color:"#64748b",fontWeight:700,padding:"10px 12px",fontSize:12,background:"#f8fafc",whiteSpace:"nowrap"},O={...C,cursor:"pointer",userSelect:"none"},T={borderBottom:"1px solid #f1f5f9",padding:"10px 12px",color:"#334155",fontSize:13,verticalAlign:"middle"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:14},children:[e.jsx(de,{icon:e.jsx(Ve,{size:18,style:{color:"#6366f1"}}),iconBg:"#eef2ff",label:"전체 예산 회차",value:`${R.total}개`,sub:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px 10px",marginTop:6},children:[e.jsxs(te,{color:"#94a3b8",children:["대기 ",R.DRAFT||0]}),e.jsxs(te,{color:"#3b82f6",children:["접수 ",R.PENDING||0]}),e.jsxs(te,{color:"#f97316",children:["접수마감 ",R.EXPIRED||0]}),e.jsxs(te,{color:"#f59e0b",children:["마감 ",R.CLOSED||0]})]})}),e.jsx(de,{icon:e.jsx(Re,{size:18,style:{color:"#10b981"}}),iconBg:"#ecfdf5",label:"부서 편성 현황",value:E.total>0?`${E.completed} / ${E.total}`:"—",sub:E.total>0?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{height:5,borderRadius:99,background:"#e2e8f0",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:"linear-gradient(90deg,#10b981,#059669)",width:`${Math.round(E.completed/E.total*100)}%`,transition:"width 0.4s"}})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:5,fontSize:11},children:[e.jsxs("span",{style:{color:"#059669",fontWeight:700},children:["완료 ",E.completed]}),e.jsxs("span",{style:{color:"#d97706",fontWeight:700},children:["진행 ",E.inProgress]}),e.jsxs("span",{style:{color:"#94a3b8"},children:["미시작 ",E.notStarted]})]})]}):e.jsx("span",{style:{fontSize:12,color:"#94a3b8",marginTop:4,display:"block"},children:"데이터 없음"})}),e.jsx(de,{icon:e.jsx(pe,{size:18,style:{color:"#f59e0b"}}),iconBg:"#fffbeb",label:"집계 항목 / 금액",value:`${W.toLocaleString()}건`,sub:e.jsx("div",{style:{fontSize:12,color:"#64748b",marginTop:6,fontWeight:600},children:P>0?`${P.toLocaleString()}원`:e.jsx("span",{style:{color:"#94a3b8"},children:"집계 전"})})}),e.jsxs("div",{style:{background:c?c.bg:"#f8fafc",border:`1px solid ${c?c.border:"#e2e8f0"}`,borderRadius:14,padding:"16px 20px",boxShadow:"0 1px 3px rgba(15,23,42,0.05)",display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,fontWeight:700,color:c?c.color:"#94a3b8",letterSpacing:"0.04em"},children:[e.jsx(Xe,{size:13})," 마감 기한"]}),e.jsx("div",{style:{fontSize:32,fontWeight:900,color:c?c.color:"#94a3b8",lineHeight:1,marginTop:2},children:c?c.label:"—"}),e.jsx("div",{style:{fontSize:12,color:c?c.color:"#94a3b8",opacity:.85,marginTop:2},children:p?.end_date?new Date(p.end_date).toLocaleDateString("ko-KR"):"기간 미설정"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14,gap:12,flexWrap:"wrap"},children:[e.jsxs("h3",{style:{margin:0,fontSize:15,fontWeight:800,color:"#0f172a"},children:["예산서 목록",e.jsxs("span",{style:{marginLeft:8,fontSize:12,fontWeight:600,color:"#94a3b8"},children:["(",t.length,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"inline-flex",border:"1px solid #cbd5e1",borderRadius:10,overflow:"hidden",background:"#fff"},children:[e.jsxs("button",{type:"button",onClick:()=>$("card"),style:{border:"none",padding:"8px 10px",background:L==="card"?"#eff6ff":"#fff",color:L==="card"?"#1d4ed8":"#64748b",fontWeight:700,fontSize:12,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:5},title:"카드 보기",children:[e.jsx(gt,{size:14})," 카드"]}),e.jsxs("button",{type:"button",onClick:()=>$("list"),style:{border:"none",borderLeft:"1px solid #e2e8f0",padding:"8px 10px",background:L==="list"?"#eff6ff":"#fff",color:L==="list"?"#1d4ed8":"#64748b",fontWeight:700,fontSize:12,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:5},title:"목록 보기",children:[e.jsx(bt,{size:14})," 목록"]})]}),e.jsx("select",{value:A,onChange:r=>y(r.target.value),style:{...yt,minWidth:190,fontSize:12,padding:"8px 10px"},title:"정렬 항목",children:k.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsxs("button",{type:"button",onClick:w,style:{border:"1px solid #cbd5e1",borderRadius:8,background:"#fff",padding:"8px 10px",fontSize:12,fontWeight:700,color:"#334155",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:6},title:"정렬 방향 전환",children:[e.jsx(at,{size:13}),a==="asc"?"오름차순":"내림차순"]}),o&&e.jsxs("button",{onClick:()=>N(!0),style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:10,background:"linear-gradient(135deg,#2563eb,#3b82f6)",color:"#fff",border:"none",cursor:"pointer",fontSize:13,fontWeight:700,boxShadow:"0 2px 8px rgba(37,99,235,0.25)"},children:[e.jsx(Ee,{size:14})," 신규 예산서 접수"]})]})]}),t.length===0?e.jsx("div",{style:{textAlign:"center",padding:"48px 24px",background:"#fff",borderRadius:16,border:"1px dashed #e2e8f0",color:"#94a3b8",fontSize:13},children:"접수된 예산서가 없습니다. 신규 예산서를 생성해 주세요."}):L==="card"?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:v.map(r=>e.jsx(mt,{item:r,rank:F[r.id],canManage:o,handleGoDetail:f,setVersion:i,setIsEditModalOpen:_,handleCloseVersion:M,handleReopenVersion:h,handleDeleteVersion:B,progressData:b,summaryVersionId:l},r.id))}):e.jsx("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:920},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{style:O,onClick:()=>z("name"),children:["예산명",I("name")]}),e.jsxs("th",{style:O,onClick:()=>z("year"),children:["연도",I("year")]}),e.jsxs("th",{style:O,onClick:()=>z("round"),children:["회차",I("round")]}),e.jsxs("th",{style:O,onClick:()=>z("status"),children:["상태",I("status")]}),e.jsxs("th",{style:O,onClick:()=>z("start_date"),children:["시작일",I("start_date")]}),e.jsxs("th",{style:O,onClick:()=>z("end_date"),children:["종료일",I("end_date")]}),e.jsx("th",{style:{...C,width:110},children:"D-day"}),e.jsx("th",{style:{...C,width:110},children:"지침"}),e.jsx("th",{style:{...C,width:150,textAlign:"center"},children:"관리"})]})}),e.jsx("tbody",{children:v.map(r=>{const g=ie[r.status]||ie.DRAFT,j=ce(r.end_date),u=r.status==="CLOSED";return e.jsxs("tr",{style:{opacity:u?.72:1},children:[e.jsx("td",{style:T,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("strong",{style:{color:"#0f172a"},children:r.name}),e.jsxs("span",{style:{fontSize:11,color:"#94a3b8"},children:["ID ",r.id]})]})}),e.jsx("td",{style:T,children:r.year}),e.jsx("td",{style:T,children:r.round??0}),e.jsx("td",{style:T,children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:999,background:g.bg,color:g.color,border:"1px solid "+g.border,fontSize:11,fontWeight:700},children:[e.jsx("span",{style:{width:6,height:6,borderRadius:"50%",background:g.dot,display:"inline-block"}}),g.label]})}),e.jsx("td",{style:T,children:r.start_date||"-"}),e.jsx("td",{style:T,children:r.end_date||"-"}),e.jsx("td",{style:T,children:j?e.jsx("span",{style:{fontSize:11,fontWeight:800,padding:"2px 8px",borderRadius:999,background:j.bg,color:j.color,border:"1px solid "+j.border},children:j.label}):"-"}),e.jsx("td",{style:T,children:r.guidelines?e.jsx("span",{style:{color:"#1d4ed8",fontWeight:700,fontSize:12},children:"있음"}):e.jsx("span",{style:{color:"#94a3b8",fontSize:12},children:"없음"})}),e.jsx("td",{style:{...T,textAlign:"center"},children:e.jsxs("div",{style:{display:"inline-flex",gap:4},children:[e.jsx(U,{title:"상세 보기",color:"#2563eb",bg:"#eff6ff",onClick:()=>f(r),children:e.jsx(Te,{size:13})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"수정",color:"#0369a1",bg:"#f0f9ff",onClick:()=>{i(r),_(!0)},children:e.jsx(De,{size:13})}),u?e.jsx(U,{title:"재개",color:"#059669",bg:"#ecfdf5",onClick:()=>h(r),children:e.jsx(Ne,{size:13})}):e.jsx(U,{title:"마감",color:"#b45309",bg:"#fffbeb",onClick:()=>M(r),children:e.jsx(ze,{size:13})}),e.jsx(U,{title:"삭제",color:"#dc2626",bg:"#fef2f2",onClick:()=>B(r),children:e.jsx(ue,{size:13})})]})]})})]},r.id)})})]})})]})]})}function de({icon:t,iconBg:i,label:o,value:S,sub:f}){return e.jsxs("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",padding:"16px 20px",boxShadow:"0 1px 3px rgba(15,23,42,0.05)",display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:9,background:i,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t}),e.jsx("span",{style:{fontSize:11,fontWeight:700,color:"#64748b",letterSpacing:"0.04em"},children:o})]}),e.jsx("div",{style:{fontSize:26,fontWeight:900,color:"#0f172a",lineHeight:1},children:S}),f]})}function te({color:t,children:i}){return e.jsx("span",{style:{fontSize:11,fontWeight:700,color:t},children:i})}const s={pageTitle:"접수 관리",listTitle:"접수 목록",detailTitle:"접수 상세",masterTitle:"예산서 마스터",roundDetail:"회차 상세",round:"회차",inputPeriod:"입력 기간",newRoundBtn:"신규 예산서 접수",editRoundBtn:"회차 정보 수정",refreshStatus:"현황 새로고침",goToList:"목록으로",progressByDept:"부서별 진행 현황",bulkUploadTitle:"예산 항목 일괄 등록",exportOfficialBook:"공식 예산서 출력",no:"번호",year:"연도",name:"예산명",period:"기간",status:"상태",currentStatus:"현재 상태",statusControl:"상태 제어",management:"관리",dept:"부서",entryCount:"항목 수",totalAmount:"예산 합계",sourceRound:"기초데이터 원본",draft:"준비중",pending:"제출대기",confirmed:"확정",closed:"마감",active:"진행",applyYear:"적용 연도",roundName:"예산명칭",createMode:"기초데이터 설정",newCreate:"빈 상태로 시작",copyRound:"기존 회차 불러오기",originalRound:"불러올 회차",selectOriginal:"원본 회차 선택",copyNotice:"불러온 데이터는 당초 예산액 기준으로 저장되며, 증감액은 현예산액과 기존 예산액의 차이로 표시됩니다.",periodSetting:"입력 접수 기간 설정",guidelinesLabel:"부서별 작성 지침(공통)",guidelinesPlaceholder:"예산 작성 시 부서에서 참고할 지침을 입력하세요.",fileUploadLabel:"첨부 파일 등록",currentFile:"현재 파일: ",uploadPlaceholder:"파일을 드래그하거나 클릭하여 업로드하세요.",removeFile:"파일 제거",searchPlaceholder:"사업명 검색..",namePlaceholder:"예: 2027년 본예산",bulkFormat:"형식: `subject_code, org_code, name, price, qty` (콤마 구분, 줄 단위)",bulkExample:"예: 1101, D001, 사무용품, 50000, 2",noData:"표시할 데이터가 없습니다.",noProgressData:"표시할 진행 현황 데이터가 없습니다.",loadingProgress:"진행 현황을 불러오는 중...",periodUndefined:"기간 미정",save:"저장",cancel:"취소",delete:"삭제",deactivate:"비활성화",edit:"수정",view:"보기",upload:"업로드 실행",confirmDelete:t=>`"${t}" 버전을 삭제하시겠습니까? 관련 데이터도 모두 삭제됩니다.`,deleteSuccess:"삭제했습니다.",deleteFail:"삭제 실패",alreadyClosed:"이미 마감된 버전입니다.",confirmDeactivate:t=>`"${t}" 버전을 비활성화(마감)하시겠습니까?`,deactivateSuccess:"비활성화했습니다.",changeFail:"변경 실패",transferRequired:"기초데이터 불러오기를 선택한 경우 원본 회차를 선택해야 합니다.",newRoundName:t=>`${t}년 신규 회차`,createSuccess:t=>`신규 예산서가 접수되었습니다.${t>0?`
불러온 항목: ${t.toLocaleString()}건`:""}`,createFail:"생성 실패",updateSuccess:"버전 정보가 업데이트되었습니다.",updateFail:"상태 변경 실패",saveSuccess:"버전 정보가 저장되었습니다.",saveFail:"저장 실패",inputRequired:"항목을 입력해 주세요.",uploadSuccess:(t,i)=>`업로드 완료: ${t} 생성, ${i} 업데이트`,uploadFail:"업로드 실패",exportOfficialBookDone:"공식 예산서 파일을 다운로드했습니다.",exportOfficialBookFail:"공식 예산서 출력 중 오류가 발생했습니다.",sourceVersionEmpty:"선택한 원본 회차에 예산 항목이 없습니다. 다른 회차를 선택하거나 빈 상태로 시작하세요.",closeSuccess:"회차를 마감했습니다.",closeFail:"마감 처리 중 오류가 발생했습니다.",reopenSuccess:"마감을 해제했습니다.",reopenFail:"마감 해제 중 오류가 발생했습니다.",confirmClose:t=>`"${t}" 회차를 마감합니까?
마감 후에는 모든 편집이 잠깁니다.`,confirmReopen:t=>`"${t}" 회차의 마감을 해제합니까?`,summaryTotalRounds:"전체 예산서",summaryActiveRound:"진행 중 회차",summaryDeptStatus:"부서 현황",summaryCompleted:"완료",summaryInProgress:"진행중",summaryNotStarted:"미시작",summaryTotalEntries:"전체 항목",summaryTotalAmount:"합계 금액",summaryDeadline:"마감 기한",summaryNoPending:"진행 중인 회차 없음",totalEntries:"전체 항목 수",totalSum:"전체 예산 합계"},{menuGhostBtn:St}=fe,J={...St,padding:"8px 14px",borderRadius:10,fontSize:13,fontWeight:700,display:"inline-flex",alignItems:"center",gap:6},_e=t=>{if(!t)return"-";const i=new Date(t);return Number.isNaN(i.getTime())?String(t):i.toLocaleDateString("ko-KR")},ne={COMPLETED:{bg:"#f0fdf4",border:"#bbf7d0",color:"#166534",barColor:"#10b981",label:"완료"},SUBMITTED:{bg:"#eff6ff",border:"#bfdbfe",color:"#1d4ed8",barColor:"#3b82f6",label:"제출됨"},WRITING:{bg:"#fffbeb",border:"#fde68a",color:"#b45309",barColor:"#f59e0b",label:"작성중"},NOT_STARTED:{bg:"#f8fafc",border:"#e2e8f0",color:"#94a3b8",barColor:"#cbd5e1",label:"미시작"},EMPTY:{bg:"#f8fafc",border:"#e2e8f0",color:"#cbd5e1",barColor:"#e2e8f0",label:"항목없음"}};function kt(t){if(!t.length)return 0;const i=t.filter(o=>o.dept_status==="COMPLETED").length;return Math.round(i/t.length*100)}function Q({icon:t,iconColor:i,iconBg:o,label:S,value:f,sub:_}){return e.jsxs("div",{style:{background:"#fff",border:"1px solid #e8edf5",borderRadius:14,padding:"14px 18px",display:"flex",alignItems:"flex-start",gap:14,boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:10,background:o,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:we.cloneElement(t,{size:17,style:{color:i}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#94a3b8",letterSpacing:"0.04em",marginBottom:3},children:S}),e.jsx("div",{style:{fontSize:15,fontWeight:800,color:"#0f172a",lineHeight:1.3},children:f}),_&&e.jsx("div",{style:{marginTop:4},children:_})]})]})}function _t({rate:t}){const i=t===100?"#059669":t>=60?"#2563eb":"#f59e0b",o=t===100?"#ecfdf5":t>=60?"#eff6ff":"#fffbeb";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,background:o,border:`1px solid ${i}22`,borderRadius:12,padding:"10px 16px"},children:[e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{height:8,borderRadius:99,background:"#e2e8f0",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:t===100?"linear-gradient(90deg,#10b981,#059669)":"linear-gradient(90deg,#60a5fa,#2563eb)",width:`${t}%`,transition:"width 0.5s ease"}})})}),e.jsxs("span",{style:{fontSize:15,fontWeight:900,color:i,minWidth:44,textAlign:"right"},children:[t,"%"]})]})}function vt({version:t,canManage:i,setViewMode:o,fetchProgress:S,progressData:f=[],loadingProgress:_,setIsEditModalOpen:M,onExportBudgetBook:h,onClose:B,onReopen:N}){const b=f.reduce((y,a)=>y+Number(a.total_entries||0),0),l=f.reduce((y,a)=>y+Number(a.total_amount||0),0),p=kt(f),c=t?.status==="CLOSED",[E,R]=d.useState({}),W=y=>R(a=>({...a,[y]:!a[y]})),P=f.filter(y=>y.dept_status==="COMPLETED").length,L=f.filter(y=>["WRITING","SUBMITTED"].includes(y.dept_status)).length,$=d.useMemo(()=>{const y={};return f.forEach(a=>{const m=a.org_id,k=a.parent_id,w=k||m;y[w]||(y[w]={dept:null,teams:[]}),k?y[w].teams.push({...a}):y[w].dept={...a}}),Object.values(y).map(a=>{if(!a.dept){if(!a.teams.length)return null;a.dept={...a.teams[0],org_name:`${a.teams[0].org_name} (그룹)`,isPlaceholder:!0}}if(a.teams.length>0){const m=a.teams.reduce((w,z)=>(w.total_entries+=Number(z.total_entries||0),w.total_amount+=Number(z.total_amount||0),w.finalized+=Number(z.status_counts?.FINALIZED||0),w),{total_entries:Number(a.dept.total_entries||0),total_amount:Number(a.dept.total_amount||0),finalized:Number(a.dept.status_counts?.FINALIZED||0)});a.dept.total_entries=m.total_entries,a.dept.total_amount=m.total_amount;const k=m.total_entries>0?Math.round(m.finalized/m.total_entries*100):0;a.dept.aggregatedBarPct=k,m.total_entries>0&&(k===100?a.dept.dept_status="COMPLETED":k>0?a.dept.dept_status="SUBMITTED":a.dept.dept_status="WRITING")}else{const m=Number(a.dept.total_entries||0),k=Number(a.dept.status_counts?.FINALIZED||0);a.dept.aggregatedBarPct=m>0?Math.round(k/m*100):0}return a}).filter(Boolean).sort((a,m)=>(a.dept.org_name||"").localeCompare(m.dept.org_name||""))},[f]),A=y=>{window.location.assign(`/api/versions/${t.id}/export-department-budget/?org_id=${y}`)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:10,background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:"14px 20px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("button",{type:"button",style:J,onClick:()=>o("list"),children:[e.jsx(rt,{size:14})," ",s.goToList]}),e.jsx("div",{style:{width:1,height:20,background:"#e2e8f0"}}),e.jsxs("span",{style:{fontSize:15,fontWeight:800,color:"#0f172a"},children:[t?.year,"년 ",t?.name]}),e.jsx(tt,{status:t?.status,type:"version"})]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:J,onClick:()=>S(),children:[e.jsx(ye,{size:14})," ",s.refreshStatus]}),e.jsxs("button",{type:"button",style:J,onClick:h,children:[e.jsx(me,{size:14})," ",s.exportOfficialBook]}),i&&e.jsxs("button",{type:"button",style:J,onClick:()=>M(!0),children:[e.jsx(qe,{size:14})," ",s.editRoundBtn]}),i&&t&&(c?e.jsxs("button",{type:"button",onClick:()=>N?.(t),style:{...J,border:"1px solid #86efac",background:"#f0fdf4",color:"#166534"},children:[e.jsx(Ze,{size:14})," 마감 해제"]}):e.jsxs("button",{type:"button",onClick:()=>B?.(t),style:{...J,border:"1px solid #fca5a5",background:"#fff1f2",color:"#b91c1c"},children:[e.jsx(He,{size:14})," 회차 마감"]}))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:12},children:[e.jsx(Q,{icon:e.jsx(ut,{}),iconColor:"#6366f1",iconBg:"#eef2ff",label:"예산 회차",value:`${t?.year}년 / ${t?.name||`${t?.round??0}차`}`}),e.jsx(Q,{icon:e.jsx(Ie,{}),iconColor:"#0ea5e9",iconBg:"#f0f9ff",label:"입력 기간",value:`${_e(t?.start_date)} ~ ${_e(t?.end_date)}`}),e.jsx(Q,{icon:e.jsx(pe,{}),iconColor:"#f59e0b",iconBg:"#fffbeb",label:"총 예산 항목",value:`${b.toLocaleString()}건`}),e.jsx(Q,{icon:e.jsx(nt,{}),iconColor:"#10b981",iconBg:"#ecfdf5",label:"총 예산 금액",value:l>0?`${l.toLocaleString()}원`:"집계 전"}),e.jsx(Q,{icon:e.jsx(Re,{}),iconColor:"#059669",iconBg:"#ecfdf5",label:"부서 완료 현황",value:f.length>0?`${P} / ${f.length}`:"—",sub:f.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,fontSize:11},children:[e.jsxs("span",{style:{color:"#059669",fontWeight:700},children:["완료 ",P]}),e.jsxs("span",{style:{color:"#d97706",fontWeight:700},children:["진행 ",L]}),e.jsxs("span",{style:{color:"#94a3b8"},children:["미시작 ",f.length-P-L]})]})}),e.jsx(Q,{icon:e.jsx(ot,{}),iconColor:"#2563eb",iconBg:"#eff6ff",label:"전체 완료율",value:f.length>0?`${p}%`:"—",sub:f.length>0&&e.jsx("div",{style:{height:5,borderRadius:99,background:"#e2e8f0",overflow:"hidden",marginTop:6},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:p===100?"linear-gradient(90deg,#10b981,#059669)":"linear-gradient(90deg,#60a5fa,#2563eb)",width:`${p}%`,transition:"width 0.5s"}})})})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:16,overflow:"hidden",boxShadow:"0 1px 4px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{padding:"16px 22px",borderBottom:"1px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"space-between",background:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:800,color:"#0f172a"},children:[e.jsx(ye,{size:16,style:{color:"#3b82f6"}}),s.progressByDept]}),f.length>0&&e.jsx("div",{style:{minWidth:220},children:e.jsx(_t,{rate:p})})]}),_?e.jsx("div",{style:{padding:60},children:e.jsx(Ye,{message:s.loadingProgress})}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"2px solid #e2e8f0"},children:[{label:s.dept,align:"left",pl:22},{label:s.status,align:"center",w:100},{label:"진행률",align:"left",w:180},{label:s.entryCount,align:"right"},{label:s.totalAmount,align:"right"},{label:"출력",align:"right",pr:22}].map(({label:y,align:a,w:m,pl:k,pr:w})=>e.jsx("th",{style:{padding:"10px 14px",...k?{paddingLeft:k}:{},...w?{paddingRight:w}:{},...m?{width:m}:{},textAlign:a,fontSize:11,fontWeight:700,color:"#64748b",letterSpacing:"0.04em",whiteSpace:"nowrap"},children:y},y))})}),e.jsx("tbody",{children:$.length?$.map((y,a)=>{const m=y.dept,k=ne[m.dept_status]||ne.NOT_STARTED,w=m.aggregatedBarPct??0,z=E[m.org_id],I=y.teams.length>0;return e.jsxs(we.Fragment,{children:[e.jsxs("tr",{style:{background:a%2===0?"#fff":"#fafbfc",borderBottom:"1px solid #f1f5f9",cursor:I?"pointer":"default",transition:"background 0.12s"},onMouseEnter:v=>{v.currentTarget.style.background="#f0f4ff"},onMouseLeave:v=>{v.currentTarget.style.background=a%2===0?"#fff":"#fafbfc"},onClick:()=>I&&W(m.org_id),children:[e.jsx("td",{style:{padding:"11px 14px",paddingLeft:22,fontWeight:700,color:"#0f172a",fontSize:13},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7},children:[I?z?e.jsx(Je,{size:13,style:{color:"#64748b",flexShrink:0}}):e.jsx(it,{size:13,style:{color:"#64748b",flexShrink:0}}):e.jsx("div",{style:{width:13}}),m.org_name||"-",I&&e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:"#94a3b8",background:"#f1f5f9",borderRadius:4,padding:"1px 5px"},children:[y.teams.length,"팀"]})]})}),e.jsx("td",{style:{padding:"11px 14px",textAlign:"center"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:11,fontWeight:700,padding:"3px 9px",borderRadius:999,background:k.bg,color:k.color,border:`1px solid ${k.border}`},children:[e.jsx("span",{style:{width:5,height:5,borderRadius:"50%",background:k.barColor,display:"inline-block"}}),k.label]})}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{flex:1,height:7,borderRadius:99,background:"#f1f5f9",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:m.dept_status==="COMPLETED"?"linear-gradient(90deg,#10b981,#059669)":`linear-gradient(90deg,${k.barColor}99,${k.barColor})`,width:`${w}%`,transition:"width 0.4s"}})}),e.jsxs("span",{style:{fontSize:11,fontWeight:800,color:k.color,minWidth:34,textAlign:"right"},children:[w,"%"]})]})}),e.jsx("td",{style:{padding:"11px 14px",textAlign:"right",fontSize:13,color:"#334155",fontVariantNumeric:"tabular-nums"},children:Number(m.total_entries||0).toLocaleString()}),e.jsx("td",{style:{padding:"11px 14px",textAlign:"right",fontSize:13,fontWeight:700,color:"#0f172a",fontVariantNumeric:"tabular-nums"},children:Number(m.total_amount||0).toLocaleString()}),e.jsx("td",{style:{padding:"11px 14px",paddingRight:22,textAlign:"right"},children:e.jsxs("button",{onClick:v=>{v.stopPropagation(),A(m.org_id)},style:{display:"inline-flex",alignItems:"center",gap:5,fontSize:11,fontWeight:700,padding:"5px 12px",borderRadius:7,background:"#fff",border:"1px solid #e2e8f0",color:"#334155",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:v=>{v.currentTarget.style.borderColor="#2563eb",v.currentTarget.style.color="#2563eb"},onMouseLeave:v=>{v.currentTarget.style.borderColor="#e2e8f0",v.currentTarget.style.color="#334155"},children:[e.jsx(me,{size:12})," 예산서"]})})]}),z&&y.teams.map(v=>{const F=ne[v.dept_status]||ne.NOT_STARTED,C=Number(v.total_entries||0),O=Number(v.status_counts?.FINALIZED||0),T=C>0?Math.round(O/C*100):0;return e.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"9px 14px 9px 44px",color:"#475569",fontSize:12},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{color:"#cbd5e1"},children:"└"}),v.org_name||"-"]})}),e.jsx("td",{style:{padding:"9px 14px",textAlign:"center"},children:e.jsx("span",{style:{display:"inline-block",fontSize:10,fontWeight:700,padding:"2px 7px",borderRadius:999,background:F.bg,color:F.color,border:`1px solid ${F.border}`},children:F.label})}),e.jsx("td",{style:{padding:"9px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{flex:1,height:5,borderRadius:99,background:"#e2e8f0",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:F.barColor,width:`${T}%`}})}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,color:F.color,minWidth:34,textAlign:"right"},children:[T,"%"]})]})}),e.jsx("td",{style:{padding:"9px 14px",textAlign:"right",fontSize:12,color:"#475569",fontVariantNumeric:"tabular-nums"},children:C.toLocaleString()}),e.jsx("td",{style:{padding:"9px 14px",textAlign:"right",fontSize:12,fontWeight:600,color:"#334155",fontVariantNumeric:"tabular-nums"},children:Number(v.total_amount||0).toLocaleString()}),e.jsx("td",{})]},v.org_id)})]},a)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{padding:32,textAlign:"center",color:"#94a3b8",fontSize:13},children:s.noProgressData})})})]})]})]})}const{simpleLabel:Y,simpleInput:oe,simpleSelect:ve,simpleTextarea:Ct}=fe;function Ce({data:t,setData:i,currentFileUrl:o,isCreate:S=!1,fileInputId:f,transferSourceOptions:_}){const[M,h]=d.useState(t.name||""),[B,N]=d.useState(t.guidelines||"");d.useEffect(()=>{queueMicrotask(()=>{h(t.name||"")})},[t.name]),d.useEffect(()=>{queueMicrotask(()=>{N(t.guidelines||"")})},[t.guidelines]);const b=(l,p)=>{i(c=>({...c,[l]:p}))};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24,padding:"10px 0"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Y,margin:0},children:s.applyYear}),e.jsx("input",{type:"number",style:{...oe,borderRadius:10},value:t.year,onChange:l=>{const p=parseInt(l.target.value);i(c=>({...c,year:p}))}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Y,margin:0},children:s.roundName}),e.jsx("input",{style:{...oe,borderRadius:10},placeholder:s.namePlaceholder,value:M,onChange:l=>{const p=l.target.value;h(p)},onCompositionEnd:l=>{b("name",l.currentTarget.value)},onBlur:l=>{b("name",l.target.value)}})]}),S&&e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",paddingTop:20,display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Y,margin:0},children:s.createMode}),e.jsxs("select",{style:{...ve,borderRadius:10},value:t.creation_mode||"NEW",onChange:l=>{const p=l.target.value;i(c=>({...c,creation_mode:p,source_version_id:p==="TRANSFER"?c.source_version_id:""}))},children:[e.jsx("option",{value:"NEW",children:s.newCreate}),e.jsx("option",{value:"TRANSFER",children:s.copyRound})]})]}),t.creation_mode==="TRANSFER"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Y,margin:0},children:s.originalRound}),e.jsxs("select",{style:{...ve,borderRadius:10},value:t.source_version_id||"",onChange:l=>{const p=l.target.value;i(c=>({...c,source_version_id:p}))},children:[e.jsx("option",{value:"",children:s.selectOriginal}),_.map(l=>e.jsxs("option",{value:l.id,children:[l.year," ",l.name," (",l.round??0,"차)"]},l.id))]})]}),t.creation_mode==="TRANSFER"&&e.jsx("div",{style:{fontSize:12,color:"#64748b",paddingLeft:116},children:s.copyNotice})]}),e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",paddingTop:20},children:[e.jsx("label",{style:{...Y,marginBottom:8,display:"block"},children:s.periodSetting}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("input",{type:"date",style:{...oe,borderRadius:10,flex:1},value:t.start_date,onChange:l=>{const p=l.target.value;i(c=>({...c,start_date:p}))}}),e.jsx("span",{style:{color:"#94a3b8"},children:"~"}),e.jsx("input",{type:"date",style:{...oe,borderRadius:10,flex:1},value:t.end_date,onChange:l=>{const p=l.target.value;i(c=>({...c,end_date:p}))}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Y,marginBottom:8,display:"block"},children:s.guidelinesLabel}),e.jsx("textarea",{style:{...Ct,height:120,borderRadius:12,padding:16},value:B,onChange:l=>{const p=l.target.value;N(p)},onCompositionEnd:l=>{b("guidelines",l.currentTarget.value)},onBlur:l=>{b("guidelines",l.target.value)},placeholder:s.guidelinesPlaceholder})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Y,marginBottom:8,display:"block"},children:s.fileUploadLabel}),e.jsxs("div",{style:{border:"2px dashed #e2e8f0",borderRadius:12,padding:"20px",textAlign:"center",cursor:"pointer",transition:"all 0.2s",position:"relative"},onClick:()=>document.getElementById(f).click(),children:[e.jsx(Qe,{size:24,color:"#94a3b8",style:{marginBottom:8}}),e.jsx("div",{style:{fontSize:13,color:"#64748b"},children:t.file?t.file.name:o?`${s.currentFile}${o.split("/").pop()}`:s.uploadPlaceholder}),e.jsx("input",{id:f,type:"file",style:{display:"none"},onChange:l=>{const p=l.target.files[0];i(c=>({...c,file:p}))}}),(t.file||o)&&e.jsx("button",{type:"button",style:{position:"absolute",top:10,right:10,background:"none",border:"none",cursor:"pointer",color:"#ef4444"},onClick:l=>{l.stopPropagation(),i(p=>({...p,file:null}))},title:s.removeFile,children:e.jsx(ue,{size:16})})]})]})]})}function Wt({menuId:t,authAxios:i,version:o,versions:S,setVersion:f,onBootstrap:_,user:M,modalApi:h,initialUrlParams:B={}}){const N=()=>({year:new Date().getFullYear(),name:"",start_date:"",end_date:"",guidelines:"",file:null,creation_mode:"NEW",source_version_id:""}),[b,l]=d.useState(()=>B.versionId?"detail":"list"),[p,c]=d.useState({}),[,E]=d.useState(null),[R,W]=d.useState([]),[P,L]=d.useState(!1),[$,A]=d.useState(null),[y,a]=d.useState(!1),[m,k]=d.useState(!1),[w,z]=d.useState(null),[I,v]=d.useState(""),F=d.useRef(null),[C,O]=d.useState(N()),[T,r]=d.useState({year:"",name:"",start_date:"",end_date:"",guidelines:""}),[g,j]=d.useState(!1),[u,q]=d.useState(""),[,We]=d.useState(null),se=M?.role==="ADMIN",K=d.useCallback(async n=>{const x=n||o?.id;if(x){L(!0);try{const D=await i.get(`/api/versions/${x}/progress/`);W(D.data)}catch(D){console.error(D)}finally{L(!1)}}},[i,o?.id]);d.useEffect(()=>{const n={};S.forEach(x=>{n[x.id]=x.status}),c(n)},[S]),d.useEffect(()=>{if(b==="list"){const n=S.find(x=>["PENDING","DRAFT","EXPIRED"].includes(x.status));n&&n.id!==$&&(A(n.id),K(n.id))}},[b,S,$,K]),d.useEffect(()=>{o&&o.id&&(b==="detail"&&K(o.id),r({year:o.year,name:o.name,start_date:o.start_date||"",end_date:o.end_date||"",guidelines:o.guidelines||""}))},[o,b,K]);const xe=d.useRef(!1);d.useEffect(()=>{if(xe.current||!S.length)return;const n=B.versionId;if(!n)return;const x=S.find(D=>D.id===n);x&&(f(x),l("detail")),xe.current=!0},[S,B.versionId,f]),d.useEffect(()=>{if(b==="detail"&&o?.id){const n=`/intake/versions/${o.id}`;window.location.pathname!==n&&window.history.pushState({},"",n)}else b==="list"&&window.location.pathname!=="/intake"&&window.history.pushState({},"","/intake")},[b,o?.id]);const Me=d.useMemo(()=>[...S].sort((n,x)=>x.year-n.year||x.round-n.round),[S]),Le=async n=>{if(await h.confirm(s.confirmDelete(n.name)))try{await i.delete(`/api/versions/${n.id}/`),await _(),await h.alert(s.deleteSuccess)}catch(x){if(x.response?.status===409&&x.response?.data?.can_force){const D=x.response.data.entry_count;v(""),z({version:n,entryCount:D}),setTimeout(()=>F.current?.focus(),80)}else await h.alert(G(x,s.deleteFail))}},ge=async()=>{if(w)try{await i.delete(`/api/versions/${w.version.id}/force-delete/`),z(null),await _(),await h.alert(s.deleteSuccess)}catch(n){await h.alert(G(n,s.deleteFail))}},he=async n=>{if(await h.confirm(s.confirmClose(n.name)))try{await i.post(`/api/versions/${n.id}/close/`),await _(),await h.alert(s.closeSuccess)}catch(x){await h.alert(G(x,s.closeFail))}},be=async n=>{if(await h.confirm(s.confirmReopen(n.name)))try{await i.post(`/api/versions/${n.id}/reopen/`),await _(),await h.alert(s.reopenSuccess)}catch(x){await h.alert(G(x,s.reopenFail))}},$e=async()=>{try{if(C.creation_mode==="TRANSFER"&&!C.source_version_id){await h.alert(s.transferRequired);return}const n=new FormData;n.append("year",C.year),n.append("name",C.name||s.newRoundName(C.year)),n.append("start_date",C.start_date),n.append("end_date",C.end_date),n.append("guidelines",C.guidelines),n.append("creation_mode",C.creation_mode||"NEW"),n.append("base_data_mode",(C.creation_mode||"NEW")==="TRANSFER"?"IMPORT_PREVIOUS":"NEW"),C.source_version_id&&(n.append("source_version_id",C.source_version_id),n.append("base_version_id",C.source_version_id)),C.file&&n.append("guidelines_file",C.file);const x=await i.post("/api/versions/create_next_round/",n,{headers:{"Content-Type":"multipart/form-data"}});await _(),a(!1),O(N());const D=Number(x?.data?.cloned_count||0);await h.alert(s.createSuccess(D))}catch(n){const D=n?.response?.data?.error==="source version has no entries"?s.sourceVersionEmpty:G(n,s.createFail);await h.alert(D)}},Be=async n=>{const x=p[n.id];if(!(!x||x===n.status)){E(n.id);try{await i.patch(`/api/versions/${n.id}/`,{status:x,confirmed_at:x==="CONFIRMED"?new Date().toISOString():null}),await _(),await h.alert(s.updateSuccess)}catch(D){await h.alert(G(D,s.updateFail))}finally{E(null)}}},Pe=async()=>{if(o)try{const n=new FormData;n.append("year",T.year),n.append("name",T.name),n.append("start_date",T.start_date),n.append("end_date",T.end_date),n.append("guidelines",T.guidelines),T.file?n.append("guidelines_file",T.file):T.file===null&&o.guidelines_file&&n.append("guidelines_file","");const x=await i.patch(`/api/versions/${o.id}/`,n,{headers:{"Content-Type":"multipart/form-data"}});f(x.data),await _(),k(!1),r({year:"",name:"",start_date:"",end_date:"",guidelines:"",file:null}),await h.alert(s.saveSuccess)}catch(n){await h.alert(G(n,s.saveFail))}},Fe=async()=>{if(!u.trim())return h.alert(s.inputRequired);try{const x=u.trim().split(`
`).map(X=>{const[re,le,ee,H,Ue]=X.split(",").map(Ge=>Ge.trim());return{subject_code:re,org_code:le,details:[{name:ee,price:parseInt(H)||0,qty:parseFloat(Ue)||0,freq:1,source:"자체"}]}}).filter(X=>X.subject_code&&X.org_code),D=await i.post("/api/entries/bulk-upsert/",{year:o.year,round:o.round||0,entries:x});We(D.data),await _(),q(""),await h.alert(s.uploadSuccess(D.data.created,D.data.updated)),K(o.id)}catch(n){await h.alert(G(n,s.uploadFail))}},Oe=n=>{f(n),l("detail")},Ae=async()=>{if(o?.id)try{const n=await i.get(`/api/versions/${o.id}/export-budget-book/`,{responseType:"blob"}),D=(n.headers?.["content-disposition"]||"").match(/filename\*=UTF-8''([^;]+)/i),X=`budget_book_${o.year}_r${o.round}.xlsx`,re=D?decodeURIComponent(D[1]):X,le=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ee=window.URL.createObjectURL(le),H=document.createElement("a");H.href=ee,H.download=re,document.body.appendChild(H),H.click(),H.remove(),window.URL.revokeObjectURL(ee),await h.alert(s.exportOfficialBookDone)}catch(n){await h.alert(G(n,s.exportOfficialBookFail))}};return e.jsxs(Ke,{menuId:t,user:M,breadcrumbs:b==="detail"?[{label:s.pageTitle,onClick:()=>l("list")},{label:s.listTitle,onClick:()=>l("list")},`${s.detailTitle} (${o?.name||""})`]:[s.pageTitle,s.listTitle],contextBadge:o?`${o.year}년 ${o.name}`:"",actions:b==="list"&&se?[{label:s.newRoundBtn,onClick:()=>a(!0),icon:e.jsx(Ee,{size:16})}]:[],children:[e.jsx("div",{style:{padding:"0 20px 40px 20px"},children:b==="list"?e.jsx(jt,{versions:S,version:o,setVersion:f,setViewMode:l,canManage:se,statusById:p,setStatusById:c,saveVersionStatus:Be,handleGoDetail:Oe,setIsEditModalOpen:k,handleCloseVersion:he,handleReopenVersion:be,handleDeleteVersion:Le,setIsCreateModalOpen:a,progressData:R,summaryVersionId:$}):e.jsx(vt,{version:o,canManage:se,setViewMode:l,fetchProgress:K,progressData:R,loadingProgress:P,setIsEditModalOpen:k,handleBulkUpload:Fe,csvContent:u,setCsvContent:q,isBulkExpanded:g,setIsBulkExpanded:j,onExportBudgetBook:Ae,onClose:he,onReopen:be})}),e.jsxs(je,{isOpen:y,onClose:()=>a(!1),title:s.newRoundBtn,width:600,children:[e.jsx(Ce,{data:C,setData:O,isCreate:!0,fileInputId:"version-file-input-create",transferSourceOptions:Me}),e.jsx("div",{style:{paddingTop:20,borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",marginTop:10},children:e.jsx("button",{type:"button",style:{background:"#2563eb",color:"#fff",border:"none",padding:"12px 32px",borderRadius:12,fontWeight:800,cursor:"pointer",boxShadow:"0 4px 6px -1px rgba(37,99,235,0.2)"},onClick:$e,children:s.newRoundBtn})})]}),e.jsxs(je,{isOpen:m,onClose:()=>k(!1),title:s.editRoundBtn,width:600,children:[e.jsx(Ce,{data:T,setData:r,currentFileUrl:o?.guidelines_file,fileInputId:"version-file-input-edit"}),e.jsx("div",{style:{paddingTop:20,borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",marginTop:10},children:e.jsx("button",{type:"button",style:{background:"#10b981",color:"#fff",border:"none",padding:"12px 32px",borderRadius:12,fontWeight:800,cursor:"pointer",boxShadow:"0 4px 6px -1px rgba(16,185,129,0.2)"},onClick:Pe,children:s.save})})]}),w&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(15,23,42,0.55)",backdropFilter:"blur(3px)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:20,width:480,maxWidth:"90vw",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.35)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",padding:"20px 24px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(et,{size:22,color:"#fff"}),e.jsx("span",{style:{color:"#fff",fontWeight:800,fontSize:17},children:"예산서 강제 삭제"})]}),e.jsxs("div",{style:{padding:"24px 24px 20px"},children:[e.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fca5a5",borderRadius:12,padding:"14px 16px",marginBottom:20},children:[e.jsx("p",{style:{margin:0,fontWeight:700,color:"#b91c1c",fontSize:14,marginBottom:6},children:"⚠ 이 작업은 되돌릴 수 없습니다"}),e.jsxs("p",{style:{margin:0,color:"#7f1d1d",fontSize:13,lineHeight:1.6},children:[e.jsxs("strong",{children:['"',w.version.name,'"']})," 예산서와 연결된"," ",e.jsxs("strong",{children:["예산 항목 ",w.entryCount.toLocaleString(),"건"]}),"이 모두 영구 삭제됩니다."]})]}),e.jsxs("p",{style:{margin:"0 0 10px",fontSize:13,color:"#475569",fontWeight:600},children:["계속하려면 아래 입력란에 ",e.jsx("code",{style:{background:"#f1f5f9",padding:"2px 7px",borderRadius:5,fontFamily:"monospace",fontWeight:800,color:"#dc2626",fontSize:13},children:"DELETE"})," 를 입력하세요."]}),e.jsx("input",{ref:F,type:"text",value:I,onChange:n=>v(n.target.value),onKeyDown:n=>{n.key==="Enter"&&I==="DELETE"&&ge()},placeholder:"DELETE",style:{width:"100%",boxSizing:"border-box",border:`2px solid ${I==="DELETE"?"#dc2626":"#e2e8f0"}`,borderRadius:10,padding:"10px 14px",fontSize:15,fontWeight:700,fontFamily:"monospace",outline:"none",color:"#0f172a",transition:"border-color 0.2s"}})]}),e.jsxs("div",{style:{padding:"0 24px 24px",display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{z(null),v("")},style:{padding:"10px 22px",borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",color:"#475569",fontWeight:700,cursor:"pointer",fontSize:14},children:"취소"}),e.jsx("button",{type:"button",disabled:I!=="DELETE",onClick:ge,style:{padding:"10px 22px",borderRadius:10,border:"none",background:I==="DELETE"?"#dc2626":"#fca5a5",color:"#fff",fontWeight:800,fontSize:14,cursor:I==="DELETE"?"pointer":"not-allowed",transition:"background 0.2s",boxShadow:I==="DELETE"?"0 4px 6px -1px rgba(220,38,38,0.3)":"none"},children:"강제 삭제"})]})]})})]})}export{Wt as default};
