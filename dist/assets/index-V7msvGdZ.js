import{c as pt,j as e,m as je,H as bt,n as ne,a as s,h as Oe,i as ht,M as xt,_ as yt}from"./index-zrOWfT8F.js";import{E as Ee}from"./EmptyState-DNisZk5x.js";import{I as gt}from"./InfoBox-Gp7lkYZS.js";import{S as jt}from"./search-BTobpTzg.js";import{R as St}from"./rotate-ccw-CDNNjM5o.js";import{S as Nt}from"./StatusBadge-BWeRFWtv.js";import{C as It,T as wt}from"./TraditionalLedgerView-AJRvwCId.js";import{E as _t}from"./paperclip-DhIonsE5.js";import{X as qe}from"./x-DmlADNKy.js";import"./shared-PQM6ZA3T.js";import"./triangle-alert-B3xAXXJr.js";import"./building-2-C9dQTGyB.js";const At=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Dt=pt("sparkles",At),{menuPanelCard:Rt,menuPanelBody:kt,simpleSelect:ke,simpleInput:Et,menuGhostBtn:Lt}=je;function Ct({version:r,versionOptions:o,selectableDepartments:d,selectableTeams:y,selectedDeptId:w,selectedTeamId:l,statusFilter:p,searchText:g,canChangeDept:k,onChange:h}){return e.jsx("section",{style:{...Rt,minHeight:"auto"},children:e.jsx("div",{style:{...kt,padding:"12px 14px"},children:e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("select",{style:{...ke,minWidth:210,fontWeight:600},"aria-label":"ì˜ˆì‚° íšŒì°¨",value:r?.id?String(r.id):"",onChange:u=>h.handleVersionChange(u.target.value),children:[!r?.id&&e.jsx("option",{value:"",children:"íšŒì°¨ ì„ íƒ"}),o.map(u=>e.jsxs("option",{value:u.id,children:[u.year," / ",u.name||`${u.round}ì°¨`]},u.id))]}),e.jsxs("select",{style:{...ke,minWidth:190,fontWeight:600},"aria-label":"ë¶€ì„œ",value:w||"",onChange:u=>{h.setSelectedDeptId(u.target.value),h.setSelectedTeamId(""),h.setDetailDraft({})},disabled:!k,children:[e.jsx("option",{value:"",children:"ë¶€ì„œ ì„ íƒ"}),d.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsxs("select",{style:{...ke,minWidth:170},"aria-label":"íŒ€",value:l||"",onChange:u=>{h.setSelectedTeamId(u.target.value),h.setDetailDraft({})},disabled:!w||!y.length,children:[e.jsx("option",{value:"",children:"ì „ì²´ íŒ€"}),y.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsx("div",{style:{display:"flex",gap:4,background:"#f1f5f9",borderRadius:8,padding:3},children:[{value:"ALL",label:"ì „ì²´"},{value:"DRAFT",label:"ìž‘ì„±ì¤‘"},{value:"PENDING",label:"ì œì¶œ"},{value:"REVIEWING",label:"ê²€í† ì¤‘"},{value:"FINALIZED",label:"í™•ì •"}].map(u=>e.jsx("button",{type:"button",onClick:()=>h.setStatusFilter(u.value),style:{padding:"5px 10px",borderRadius:6,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",background:p===u.value?"#fff":"transparent",color:p===u.value?"#1e293b":"#64748b",boxShadow:p===u.value?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:u.label},u.value))}),e.jsxs("div",{style:{flex:1,minWidth:220,display:"flex",alignItems:"center",gap:8,border:"1px solid #e2e8f0",borderRadius:8,padding:"0 10px",background:"#fff"},children:[e.jsx(jt,{size:14,color:"#94a3b8"}),e.jsx("input",{style:{...Et,border:"none",minWidth:0,width:"100%",padding:"7px 0",fontSize:13},"aria-label":"ê²€ìƒ‰",placeholder:"ID / ì˜ˆì‚°í•­ëª© / ì¡°ì§ëª… ê²€ìƒ‰",value:g,onChange:u=>h.setSearchText(u.target.value)})]}),e.jsxs("button",{type:"button",style:{...Lt,display:"flex",alignItems:"center",gap:5,fontSize:13,padding:"7px 10px",color:"#64748b"},onClick:h.resetFilters,children:[e.jsx(St,{size:13})," ì´ˆê¸°í™”"]})]})})})}const{menuPanelCard:vt,menuPanelHead:Tt,menuPanelBody:Wt,simpleTable:$t,simpleTh:ee,simpleTd:te}=je,Le={width:18,height:18,borderRadius:999,border:"1px solid #cbd5e1",background:"#ffffff",color:"#64748b",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:0,position:"relative"},Mt={...Le,color:"#1d4ed8",borderColor:"#93c5fd",background:"#eff6ff",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.18)"},zt={...Le,color:"#b91c1c",borderColor:"#fecaca",background:"#fef2f2"},Ft={display:"inline-flex",alignItems:"center",justifyContent:"center",gap:4,border:"1px solid #bfdbfe",borderRadius:7,background:"#eff6ff",color:"#1d4ed8",cursor:"pointer",padding:"4px 8px",fontSize:11,fontWeight:700,whiteSpace:"nowrap"},Bt={position:"absolute",top:-4,right:-4,width:12,height:12,borderRadius:999,background:"#2563eb",color:"#ffffff",display:"inline-flex",alignItems:"center",justifyContent:"center",border:"1px solid #ffffff"};function Pt({groups:r,selectedGroupKey:o,onSelectGroup:d,onOpenLog:y,onOpenDetail:w}){return e.jsxs("section",{style:vt,children:[e.jsxs("div",{style:{...Tt,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ì œì¶œ ì˜ˆì‚° ëª©ë¡"}),e.jsxs("span",{style:{fontSize:12,color:"#94a3b8",fontWeight:500},children:["ì´ ",r.length,"ê±´"]})]}),e.jsx("div",{style:{...Wt,paddingTop:10,overflowX:"auto"},children:r.length?e.jsxs("table",{style:$t,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...ee,minWidth:100},children:"ì œì¶œìž ID"}),e.jsx("th",{style:{...ee,minWidth:230},children:"ì œì¶œ ì˜ˆì‚° í•­ëª©"}),e.jsx("th",{style:{...ee,minWidth:120},children:"ì¡°ì§"}),e.jsx("th",{style:{...ee,minWidth:170},children:"ì œì¶œ ì •ë³´"}),e.jsx("th",{style:{...ee,minWidth:160},children:"ìƒíƒœ / ë¡œê·¸"}),e.jsx("th",{style:{...ee,minWidth:110,textAlign:"right"},children:"ê¸ˆì•¡"}),e.jsx("th",{style:{...ee,minWidth:88,textAlign:"center"},children:"ê²€í† "})]})}),e.jsx("tbody",{children:r.map(l=>{const p=String(o||"")===String(l.key);return e.jsxs("tr",{onClick:()=>{d(l.key),w(l)},style:{background:p?"#eff6ff":"#ffffff",cursor:"pointer"},children:[e.jsx("td",{style:te,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("span",{style:{fontSize:12,color:"#0f172a",fontWeight:700},children:l.submitterId}),e.jsx("span",{style:{fontSize:11,color:"#64748b"},children:l.submitterName||"-"})]})}),e.jsx("td",{style:te,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("span",{style:{fontSize:12,color:"#334155",fontWeight:700},children:l.subjectSummaryLabel}),e.jsxs("span",{style:{fontSize:11,color:"#64748b"},children:["ì˜ˆì‚° í•­ëª© ",l.entryCount,"ê±´"]})]})}),e.jsx("td",{style:te,children:l.organizationSummary}),e.jsx("td",{style:te,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("span",{style:{fontSize:11,color:"#334155",fontWeight:700},children:l.submitterId}),e.jsx("span",{style:{fontSize:11,color:"#64748b"},children:l.submittedAtLabel||"-"}),e.jsx("span",{style:{fontSize:11,color:"#64748b"},children:`ì‚°ì¶œë‚´ì—­ ${l.detailCount}ê±´`})]})}),e.jsx("td",{style:te,children:e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsx(Nt,{status:l.status}),l.changeLogCount>0&&e.jsxs("button",{type:"button",style:l.hasNewLog?Mt:Le,title:l.hasNewLog?"ìƒˆ ë³€ê²½ ë¡œê·¸":"ë³€ê²½ ë¡œê·¸",onClick:g=>{g.stopPropagation(),y(l,"change")},children:[e.jsx(bt,{size:11}),l.hasNewLog&&e.jsx("span",{style:Bt,children:e.jsx(Dt,{size:8})})]}),l.rejectLogCount>0&&e.jsx("button",{type:"button",style:zt,title:"ë°˜ë ¤ ì˜ê²¬ ë¡œê·¸",onClick:g=>{g.stopPropagation(),y(l,"reject")},children:e.jsx(It,{size:11})})]})}),e.jsx("td",{style:{...te,textAlign:"right",fontWeight:700},children:ne(l.totalAmount||0)}),e.jsx("td",{style:{...te,textAlign:"center"},children:e.jsxs("button",{type:"button",style:Ft,onClick:g=>{g.stopPropagation(),w(l)},children:[e.jsx(_t,{size:12})," ìƒì„¸"]})})]},l.key)})})]}):e.jsx(Ee,{icon:"ðŸ“­",title:"ì œì¶œ ë‚´ì—­ ì—†ìŒ",message:"í˜„ìž¬ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì œì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})})]})}const O={DRAFT:"ìž‘ì„±ì¤‘",PENDING:"ë§¤ë‹ˆì € ê²€í† ì¤‘",REVIEWING:"ì´ë¬´íŒ€ ê²€í† ì¤‘",FINALIZED:"í™•ì •",MIXED:"í˜¼í•©ìƒíƒœ"},He={EDIT:"[ìˆ˜ì •]",RECALL:"[íšŒìˆ˜]"},Xe=r=>String(r||"").trim(),Ze=(r,o)=>Xe(r).startsWith(o),Gt=r=>Ze(r?.reason,He.RECALL),Vt=r=>Ze(r?.reason,He.EDIT),me=r=>!Xe(r?.reason)||(r?.to_status||"")!=="DRAFT"||Gt(r)||Vt(r)?!1:["PENDING","REVIEWING"].includes(r?.from_status||""),Ot=r=>String(r||"department").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),Ve=r=>r?String(r.id||`${r.created_at||""}:${r.from_status||""}:${r.to_status||""}:${r.reason||""}`):"",ge=r=>{if(!r)return"-";const o=new Date(r);return Number.isNaN(o.getTime())?String(r):o.toLocaleString("ko-KR",{hour12:!1})},{menuPanelCard:qt,menuPanelHead:Ht,menuPanelBody:Xt}=je,oe=(r,o,d,y)=>({border:`1px solid ${y?"#e2e8f0":d}`,borderRadius:8,padding:"7px 14px",fontSize:12,fontWeight:700,cursor:y?"not-allowed":"pointer",background:y?"#f8fafc":o,color:y?"#cbd5e1":r,whiteSpace:"nowrap"});function Zt({title:r,value:o,required:d=!0,confirmLabel:y,onChange:w,onConfirm:l,onCancel:p}){const[g,k]=s.useState(""),h=()=>{if(d&&!String(o||"").trim()){k("ì‚¬ìœ ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}k(""),l()};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:19e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(15,23,42,0.45)"},children:e.jsxs("div",{style:{width:420,maxWidth:"calc(100vw - 32px)",background:"#fff",borderRadius:14,boxShadow:"0 20px 40px -12px rgba(15,23,42,0.45)",padding:24,display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{style:{fontSize:14,color:"#0f172a"},children:r}),e.jsx("button",{type:"button",onClick:p,style:{width:24,height:24,border:"none",background:"none",color:"#64748b",cursor:"pointer"},children:e.jsx(qe,{size:15})})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:6,fontSize:11,color:"#64748b",fontWeight:700},children:["ì‚¬ìœ  ",d?e.jsx("span",{style:{color:"#dc2626"},children:"*"}):null]}),e.jsx("textarea",{value:o,onChange:u=>{w(u.target.value),g&&k("")},rows:4,placeholder:"ì‚¬ìœ ë¥¼ ìž…ë ¥í•˜ì„¸ìš”.",style:{width:"100%",boxSizing:"border-box",border:`1px solid ${g?"#fca5a5":"#e2e8f0"}`,borderRadius:8,padding:"8px 10px",fontSize:12,resize:"vertical",outline:"none",fontFamily:"inherit"}}),g?e.jsx("div",{style:{marginTop:4,fontSize:11,color:"#b91c1c"},children:g}):null]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{type:"button",style:oe("#64748b","#f8fafc","#e2e8f0"),onClick:p,children:"ì·¨ì†Œ"}),e.jsx("button",{type:"button",style:oe("#ffffff","#1d4ed8","#1d4ed8"),onClick:h,children:y})]})]})})}function Kt({pageState:r,pageActions:o,version:d,selectedDeptId:y,selectedTeamId:w,authAxios:l,modal:p,onRefreshEntries:g}){const{isAdmin:k,isManager:h,isRequestor:u,isVersionEditable:F,busyWorkflow:_,deptStatus:j,scopeEntries:E,entryLogsById:q,subjectById:U,workflowReasons:x}=r,[t,a]=s.useState(null),i=s.useMemo(()=>{const D=E.filter(B=>(B.status||"DRAFT")==="PENDING").length,z=E.filter(B=>["REVIEWING","FINALIZED"].includes(B.status||"DRAFT")).length,ie=E.filter(B=>(q[Number(B.id)]||[]).some(se=>me(se))).length;return{pending:D,forwarded:z,rejected:ie}},[E,q]),f=F&&j==="DRAFT"&&(k||u),S=F&&j==="PENDING"&&(k||h),A=F&&j==="PENDING"&&(k||h),m=F&&j!=="DRAFT"&&k,v="ì´ë¬´íŒ€ìœ¼ë¡œ ì œì¶œ",W={approve:"deptApprove",reject:"deptReject",reopen:"deptReopen"},P=async(D,z="")=>{if(!d||!y){await p.alert("ì˜ˆì‚° íšŒì°¨ì™€ ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");return}if(!E.length){await p.alert("ì²˜ë¦¬í•  ì˜ˆì‚° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");return}const ie={submit:"DRAFT",approve:j,reject:j,reopen:"FINALIZED"},B={submit:"PENDING",approve:j==="REVIEWING"?"FINALIZED":"REVIEWING",reject:"DRAFT",reopen:"DRAFT"},X=ie[D],se=B[D],ae=E.filter(T=>(T.status||"DRAFT")===X);if(!ae.length){await p.alert(`'${O[X]||X}' ìƒíƒœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.`);return}if(D==="submit"){let T=0,Z=0;if(E.forEach(Y=>{const be=Number(Y.total_amount||0);(Y.subject_type||U[Number(Y.subject)]?.subject_type)==="income"?T+=be:Z+=be}),T!==Z){await p.alert(`ìˆ˜ìž…/ì§€ì¶œ í•©ê³„ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ ì œì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ìˆ˜ìž…: ${ne(T)} / ì§€ì¶œ: ${ne(Z)} / ì°¨ì•¡: ${ne(T-Z)}`);return}}const pe={submit:"ì œì¶œ",approve:v,reject:"ë°˜ë ¤",reopen:"ìž¬ì˜¤í”ˆ"}[D];if(await p.confirm(`${ae.length}ê±´ì„ ${pe} ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
(${O[X]||X} â†’ ${O[se]||se})`)){o.setBusyWorkflow(!0);try{const T={action:D,org_id:Number(w||y),year:d.year,round:d.round,entry_ids:ae.map(Y=>Number(Y.id))};z&&(T.reason=z),D==="reopen"&&(T.to_status="DRAFT");const Z=await l.post("/api/entries/workflow/",T);await g?.(),await p.alert(Z?.data?.message||`${pe} ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`),W[D]&&o.setWorkflowReason(W[D],"")}catch(T){await p.alert(Oe(T,"ì›Œí¬í”Œë¡œìš° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."))}finally{o.setBusyWorkflow(!1)}}},M=D=>{D==="approve"&&!S||D==="reject"&&!A||D==="reopen"&&!m||a(D)},$=t?W[t]:"",Q=$&&x[$]||"",H={approve:{title:"ì´ë¬´íŒ€ ì œì¶œ ì‚¬ìœ  ìž…ë ¥",confirmLabel:"ì´ë¬´íŒ€ìœ¼ë¡œ ì œì¶œ",required:!1},reject:{title:"ë°˜ë ¤ ì‚¬ìœ  ìž…ë ¥",confirmLabel:"ë°˜ë ¤ ì‹¤í–‰",required:!0},reopen:{title:"ìž¬ì˜¤í”ˆ ì‚¬ìœ  ìž…ë ¥",confirmLabel:"ìž¬ì˜¤í”ˆ ì‹¤í–‰",required:!1}}[t];return e.jsxs(e.Fragment,{children:[t&&H&&e.jsx(Zt,{title:H.title,value:Q,required:H.required,confirmLabel:H.confirmLabel,onChange:D=>o.setWorkflowReason($,D),onConfirm:async()=>{a(null),await P(t,Q.trim())},onCancel:()=>a(null)}),e.jsxs("section",{style:qt,children:[e.jsxs("div",{style:{...Ht,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("span",{children:"ë¶€ì„œ ì›Œí¬í”Œë¡œìš°"}),e.jsxs("span",{style:{fontSize:12,color:"#64748b",fontWeight:600},children:["í˜„ìž¬ ìƒíƒœ: ",e.jsx("strong",{style:{color:"#0f172a"},children:O[j]||j})]})]}),e.jsxs("div",{style:{...Xt,gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{style:{fontSize:11,color:"#1d4ed8",background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:999,padding:"3px 10px",fontWeight:700},children:["ë§¤ë‹ˆì € ê²€í† ì¤‘ ",i.pending,"ê±´"]}),e.jsxs("span",{style:{fontSize:11,color:"#166534",background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:999,padding:"3px 10px",fontWeight:700},children:["ì´ë¬´íŒ€ ì œì¶œ ",i.forwarded,"ê±´"]}),e.jsxs("span",{style:{fontSize:11,color:"#b91c1c",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:999,padding:"3px 10px",fontWeight:700},children:["ë°˜ë ¤ ",i.rejected,"ê±´"]}),e.jsxs("span",{style:{fontSize:11,color:"#475569",background:"#f1f5f9",border:"1px solid #e2e8f0",borderRadius:999,padding:"3px 10px",fontWeight:600},children:["ì „ì²´ ",E.length,"ê±´"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[e.jsx("button",{type:"button",style:oe("#1d4ed8","#eff6ff","#bfdbfe",!f||_),disabled:!f||_,onClick:()=>P("submit"),children:"ì œì¶œ"}),e.jsx("button",{type:"button",style:oe("#15803d","#f0fdf4","#bbf7d0",!S||_),disabled:!S||_,onClick:()=>M("approve"),children:v}),e.jsx("button",{type:"button",style:oe("#b91c1c","#fef2f2","#fecaca",!A||_),disabled:!A||_,onClick:()=>M("reject"),children:"ë°˜ë ¤"}),e.jsx("button",{type:"button",style:oe("#92400e","#fffbeb","#fcd34d",!m||_),disabled:!m||_,onClick:()=>M("reopen"),children:"ìž¬ì˜¤í”ˆ"}),_?e.jsx("span",{style:{fontSize:12,color:"#64748b"},children:"ì²˜ë¦¬ ì¤‘..."}):null]}),!F&&e.jsx("div",{style:{padding:"8px 12px",borderRadius:8,border:"1px solid #fde68a",background:"#fffbeb",color:"#92400e",fontSize:12,fontWeight:600},children:"í˜„ìž¬ íšŒì°¨ëŠ” ìž ê¸ˆ ìƒíƒœìž…ë‹ˆë‹¤. ì ‘ìˆ˜ì¤‘(PENDING) íšŒì°¨ì—ì„œë§Œ ì›Œí¬í”Œë¡œìš° ì²˜ë¦¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."})]})]})]})}const{menuPanelCard:Ut,menuPanelHead:Qt,menuPanelBody:Yt,simpleTable:Jt,simpleTh:ue,simpleTd:fe}=je,en=r=>{if(!r)return"-";const o=new Date(r);return Number.isNaN(o.getTime())?String(r):o.toLocaleString("ko-KR",{hour12:!1})};function tn({logs:r}){return e.jsxs("section",{style:Ut,children:[e.jsxs("div",{style:{...Qt,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ìµœê·¼ ì›Œí¬í”Œë¡œìš° ë¡œê·¸"}),e.jsxs("span",{style:{fontSize:12,color:"#94a3b8",fontWeight:400},children:["ìµœê·¼ ",Math.min(12,r.length),"ê±´"]})]}),e.jsx("div",{style:{...Yt,paddingTop:10,overflowX:"auto"},children:r.length?e.jsxs("table",{style:Jt,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...ue,minWidth:140},children:"ì‹œê°"}),e.jsx("th",{style:{...ue,minWidth:80},children:"í•­ëª©"}),e.jsx("th",{style:{...ue,minWidth:110},children:"ì²˜ë¦¬ìž"}),e.jsx("th",{style:{...ue,minWidth:150},children:"ìƒíƒœ ë³€ê²½"}),e.jsx("th",{style:ue,children:"ì‚¬ìœ "})]})}),e.jsx("tbody",{children:r.map((o,d)=>{const y=O[o.from_status]||o.from_status||"-",w=O[o.to_status]||o.to_status||"-";return e.jsxs("tr",{children:[e.jsx("td",{style:fe,children:en(o.created_at)}),e.jsxs("td",{style:{...fe,fontWeight:700},children:["#",o.entry]}),e.jsx("td",{style:fe,children:o.actor_name||o.actor||"-"}),e.jsxs("td",{style:fe,children:[y," ","->"," ",w]}),e.jsx("td",{style:{...fe,color:o.reason?"#334155":"#94a3b8"},children:String(o.reason||"").trim()||"-"})]},o.id||`${o.entry}-${d}`)})})]}):e.jsx(Ee,{icon:"?",title:"ë¡œê·¸ ì—†ìŒ",message:"í˜„ìž¬ ë²”ìœ„ì— í‘œì‹œí•  ìµœê·¼ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤."})})]})}const N={needReview:"ê²€í†  í•„ìš”",finalized:"í™•ì •ë¨",incomeTotal:"ìˆ˜ìž… í•©ê³„",expenseTotal:"ì§€ì¶œ í•©ê³„",totalEntries:"ì´ í•­ëª© ìˆ˜",exportWorkbook:"í†µí•© ì—‘ì…€ ì¶œë ¥",deptWorkflow:"ë§¤ë‹ˆì € í™•ì¸",currentStatus:"í˜„ìž¬ ìƒíƒœ",submitted:"íŒ€ì› ì œì¶œ",approved:"ì´ë¬´íŒ€ ì œì¶œ",rejected:"ë°˜ë ¤",all:"ì „ì²´",lockedNotice:"í˜„ìž¬ íšŒì°¨ëŠ” ìž ê¸ˆ ìƒíƒœìž…ë‹ˆë‹¤. ì ‘ìˆ˜ì¤‘(PENDING) íšŒì°¨ì—ì„œë§Œ ì›Œí¬í”Œë¡œìš° ì²˜ë¦¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",processing:"ì²˜ë¦¬ ì¤‘...",rejectLogs:"ë°˜ë ¤ ì˜ê²¬ ë¡œê·¸",changeLogs:"ë³€ê²½ ë¡œê·¸",totalItems:"ì „ì²´ ê±´ìˆ˜",entryReviewTitle:"ì˜ˆì‚° í•­ëª© ê²€í† ",entryDetails:"ìƒì„¸ ì •ë³´",searchPlaceholder:"ID / ì˜ˆì‚°í•­ëª© / ì¡°ì§ëª… ê²€ìƒ‰",allTeams:"ì „ì²´ íŒ€",deptSelect:"ë¶€ì„œ ì„ íƒ",versionSelect:"íšŒì°¨ ì„ íƒ",version:"ë²„ì „",department:"ë¶€ì„œ",generatedAt:"ì¶œë ¥ì¼ì‹œ",incomeAmount:"ìˆ˜ìž…ê¸ˆì•¡",expenseAmount:"ì§€ì¶œê¸ˆì•¡",diffAmount:"ì°¨ì•¡",noLogsMsg:"í‘œì‹œí•  ë¡œê·¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.",noVersionSelected:"ì„ íƒëœ íšŒì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.",selectVersionMsg:"ë¨¼ì € ì˜ˆì‚° íšŒì°¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.",selectDeptTitle:"ë¶€ì„œ ì„ íƒ í•„ìš”",selectDeptMsg:"ê²€í† ë¥¼ ì‹œìž‘í•  ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.",exportComplete:"ì—‘ì…€ ì¶œë ¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",exportFail:"ì—‘ì…€ ì¶œë ¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",reasonTitle:"ì‚¬ìœ  ìž…ë ¥",reasonRequired:"ì‚¬ìœ ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.",reasonPlaceholder:"ì‚¬ìœ ë¥¼ ìž…ë ¥í•˜ì„¸ìš”.",confirmApprove:"ìŠ¹ì¸ ì‹¤í–‰",confirmReject:"ë°˜ë ¤ ì‹¤í–‰",confirmReopen:"ìž¬ì˜¤í”ˆ ì‹¤í–‰",approveReasonTitle:"ìŠ¹ì¸ ì‚¬ìœ  ìž…ë ¥",rejectReasonTitle:"ë°˜ë ¤ ì‚¬ìœ  ìž…ë ¥",reopenReasonTitle:"ìž¬ì˜¤í”ˆ ì‚¬ìœ  ìž…ë ¥"};function nn({isOpen:r,selectedSubmissionGroup:o,detailModalPrimaryEntry:d,detailModalTotalAmount:y,detailEntryIds:w,onClose:l,authAxios:p,entries:g,subjects:k,orgs:h,projects:u,onRefreshEntries:F,modal:_,version:j,versions:E,setVersion:q,user:U,selectedDeptId:x,selectedTeamId:t}){return!r||!o?null:e.jsx("div",{style:{position:"fixed",inset:0,zIndex:2e4,background:"rgba(15,23,42,0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:l,children:e.jsxs("div",{style:{width:"min(1320px, calc(100vw - 24px))",maxHeight:"calc(100vh - 24px)",background:"#ffffff",borderRadius:14,boxShadow:"0 20px 40px -12px rgba(15,23,42,0.5)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("strong",{style:{fontSize:"14px",color:"#0f172a"},children:N.entryReviewTitle}),e.jsxs("span",{style:{fontSize:12,color:"#64748b"},children:["ì œì¶œìž ",o.submitterName||o.submitterId," | ì˜ˆì‚° í•­ëª© ",o.entryCount,"ê±´"]})]}),e.jsx("button",{type:"button",onClick:l,style:{width:28,height:28,borderRadius:8,border:"1px solid #e2e8f0",background:"#ffffff",color:"#475569",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:0},title:"ë‹«ê¸°",children:e.jsx(qe,{size:14})})]}),e.jsx("div",{style:{padding:"10px 16px",borderBottom:"1px solid #eef2f7",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:8,background:"#f8fafc"},children:[{label:"ì œì¶œìž ID",value:o.submitterId||"-"},{label:"ì œì¶œìžëª…",value:o.submitterName||"-"},{label:"ì œì¶œì¼ì‹œ",value:o.submittedAtLabel||"-"},{label:"ê²€í†  ëŒ€ìƒ",value:d?`${d.subject_name||d.subject_code||`#${d.subject}`}${o.entryCount>1?` ì™¸ ${o.entryCount-1}ê±´`:""}`:"-"},{label:"ì‚°ì¶œë‚´ì—­",value:`${o.detailCount}ê±´ / ${ne(y)}ì›`}].map(a=>e.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:8,background:"#ffffff",padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:2},children:a.label}),e.jsx("div",{style:{fontSize:12,color:"#0f172a",fontWeight:700},children:a.value})]},a.label))}),e.jsx("div",{style:{overflow:"auto",flex:1},children:e.jsx(wt,{authAxios:p,entries:g,subjects:k,orgs:h,projects:u,onRefresh:F,modalApi:_,version:j,versions:E,setVersion:q,user:U,targetDeptId:x?Number(x):null,targetTeamId:t?Number(t):null,focusEntryIds:w,embeddedMode:!0})})]})})}function sn({authAxios:r,scopeEntryIds:o,scopeEntries:d,filteredEntries:y,version:w}){const[l,p]=s.useState({}),[g,k]=s.useState({}),h=s.useRef(!1),u=s.useRef({}),F=s.useCallback(()=>{h.current=!1,u.current={},p({}),k({})},[]);s.useEffect(()=>{let x=!1;return(async()=>{if(!o.length){p({});return}try{const a=await r.get("/api/logs/",{params:{entry_ids:o.join(","),year:w?.year,round:w?.round}}),f=(Array.isArray(a.data)?a.data:a.data?.results||[]).sort((A,m)=>new Date(m.created_at||0)-new Date(A.created_at||0)),S={};f.forEach(A=>{const m=Number(A.entry);S[m]||(S[m]=[]),S[m].push(A)}),x||p(S)}catch{x||p({})}})(),()=>{x=!0}},[r,o,w?.year,w?.round]),s.useEffect(()=>{const x={};if(Object.entries(l).forEach(([a,i])=>{const f=Ve(i?.[0]);f&&(x[String(a)]=f)}),!h.current){h.current=!0,u.current=x;return}const t={};Object.entries(x).forEach(([a,i])=>{(!u.current[a]||u.current[a]!==i)&&(t[a]=!0)}),Object.keys(t).length&&queueMicrotask(()=>{k(a=>({...a,...t}))}),u.current=x},[l]);const _=s.useMemo(()=>{const x=new Set,t=[];return Object.values(l).forEach(a=>{a.forEach(i=>{const f=i.id?`id:${i.id}`:Ve(i);x.has(f)||(x.add(f),t.push(i))})}),t.sort((a,i)=>new Date(i.created_at||0)-new Date(a.created_at||0)),t.slice(0,12)},[l]),j=s.useMemo(()=>{const x={};return d.forEach(t=>{const a=l[Number(t.id)]||[],i=a.find(v=>v?.to_status==="PENDING")||null,f=a[0]||null,S=Array.isArray(t?.details)?t.details.length:Number(t?.detail_count||0),A=i?.actor_name||i?.actor||t?.submitted_by||f?.actor_name||f?.actor||t?.latest_action_by||"-",m=i?.actor_display||t?.submitted_by_display||f?.actor_display||t?.latest_action_by_display||A;x[Number(t.id)]={submittedById:A,submittedByDisplay:m,submittedAt:i?.created_at||t?.submitted_at||null,submittedAtLabel:ge(i?.created_at||t?.submitted_at),latestActor:f?.actor_display||f?.actor_name||f?.actor||t?.latest_action_by_display||t?.latest_action_by||"-",latestAtLabel:ge(f?.created_at||t?.latest_action_at),detailCount:S,detailSummaryLabel:`ì‚°ì¶œë‚´ì—­ ${S}ê±´`}}),x},[d,l]),E=s.useMemo(()=>{const x=new Map;return y.forEach(t=>{const a=Number(t.id),i=j[a]||{},f=String(i.submittedById||t.submitted_by||"-"),S=String(i.submittedByDisplay||t.submitted_by_display||f),A=f!=="-"?f:`entry:${a}`;x.has(A)||x.set(A,{key:A,submitterId:f,submitterName:S,entries:[],entryIds:[],organizations:new Set,totalAmount:0,detailCount:0,submittedAt:null,submittedAtLabel:"-",changeLogCount:0,rejectLogCount:0,hasNewLog:!1,statusCounts:{}});const m=x.get(A);m.entries.push(t),m.entryIds.push(a),m.organizations.add(t.organization_name||String(t.organization||"-")),m.totalAmount+=Number(t.total_amount||0),m.detailCount+=Number(i.detailCount||t.detail_count||(Array.isArray(t.details)?t.details.length:0)),m.statusCounts[t.status||"DRAFT"]=(m.statusCounts[t.status||"DRAFT"]||0)+1,g[String(a)]&&(m.hasNewLog=!0);const v=l[a]||[];m.changeLogCount+=v.filter($=>!me($)).length,m.rejectLogCount+=v.filter($=>me($)).length;const W=i.submittedAt||t.submitted_at||null,P=W?new Date(W).getTime():0,M=m.submittedAt?new Date(m.submittedAt).getTime():0;P>M&&(m.submittedAt=W,m.submittedAtLabel=i.submittedAtLabel||ge(W))}),Array.from(x.values()).map(t=>{const a=Object.keys(t.statusCounts),i=a.length===1?a[0]:"MIXED",f=t.entries.map(v=>v.subject_name||v.subject_code||`#${v.subject}`),S=f.slice(0,2).join(", "),A=f.length>2?`${S} +${f.length-2}`:S,m=t.organizations.size===1?Array.from(t.organizations)[0]:`${t.organizations.size}ê°œ ë¶€ì„œ`;return{...t,status:i,entryCount:t.entries.length,subjectSummaryLabel:A,organizationSummary:m}}).sort((t,a)=>{const i=t.submittedAt?new Date(t.submittedAt).getTime():0,f=a.submittedAt?new Date(a.submittedAt).getTime():0;return f!==i?f-i:String(t.submitterId).localeCompare(String(a.submitterId))})},[y,j,l,g]),q=s.useCallback(x=>{const t=String(x);k(a=>{if(!a[t])return a;const i={...a};return delete i[t],i})},[]),U=s.useCallback((x=[])=>{k(t=>{let a=!1;const i={...t};return x.forEach(f=>{const S=String(f);i[S]&&(delete i[S],a=!0)}),a?i:t})},[]);return{entryLogsById:l,newLogEntries:g,recentWorkflowLogs:_,submissionInfoById:j,groupedSubmissions:E,clearNewLog:q,clearNewLogsByEntryIds:U,resetLogsState:F}}const rn=r=>{if(!r.length)return"DRAFT";const o=[...new Set(r.map(d=>d.status||"DRAFT"))];return o.length===1?o[0]:"MIXED"};function yn({menuId:r,authAxios:o,version:d,versions:y=[],setVersion:w,subjects:l=[],orgs:p=[],entries:g=[],projects:k=[],user:h,onRefreshEntries:u,modalApi:F}){const _=F||ht,j=h?.role==="ADMIN",E=h?.role==="MANAGER"||h?.role==="REVIEWER",q=E,U=h?.role==="STAFF"||h?.role==="REQUESTOR",x=!!(d&&d.status==="PENDING"),[t,a]=s.useState(""),[i,f]=s.useState(""),[S,A]=s.useState("ALL"),[m,v]=s.useState(""),[W,P]=s.useState(null),[M,$]=s.useState(""),[Q,H]=s.useState([]),[D,z]=s.useState(!1),[ie,B]=s.useState({}),[X,se]=s.useState(!1),[ae,pe]=s.useState(!1),[Ce,T]=s.useState(!1),[Z,Y]=s.useState(null),[be,Se]=s.useState({deptApprove:"",deptReject:"",deptReopen:"",entryApprove:"",entryReject:"",entryReopen:"",entryRecall:"",detailEdit:""}),ve=s.useMemo(()=>[...y].sort((n,c)=>c.year-n.year||c.round-n.round),[y]),he=s.useMemo(()=>p.filter(n=>n.org_type!=="team"&&!n.parent),[p]),xe=s.useMemo(()=>p.filter(n=>n.org_type==="team"||n.parent),[p]),L=s.useMemo(()=>p.find(n=>Number(n.id)===Number(h?.organization)),[p,h?.organization]),Ne=s.useMemo(()=>L?L.org_type==="team"||L.parent?Number(L.parent):Number(L.id):null,[L]),le=s.useMemo(()=>j?he:Ne?he.filter(n=>Number(n.id)===Number(Ne)):[],[he,j,Ne]);s.useEffect(()=>{if(!le.length)return;le.some(c=>String(c.id)===String(t))||a(String(le[0].id))},[le,t]);const Ie=s.useMemo(()=>t?xe.filter(n=>Number(n.parent)===Number(t)):[],[xe,t]),we=s.useMemo(()=>j||E?Ie:L?Ie.filter(n=>Number(n.id)===Number(L.id)):[],[j,E,Ie,L]);s.useEffect(()=>{if(!i)return;we.some(c=>String(c.id)===String(i))||f("")},[i,we]),s.useEffect(()=>{j||E||!L||i||(L.org_type==="team"||L.parent)&&Number(L.parent)===Number(t)&&f(String(L.id))},[j,E,L,t,i]),s.useEffect(()=>{$(""),H([]),z(!1),Se({deptApprove:"",deptReject:"",deptReopen:"",entryApprove:"",entryReject:"",entryReopen:"",entryRecall:"",detailEdit:""})},[t,i,d?.id]);const Te=s.useMemo(()=>{if(i)return[Number(i)];if(!t)return[];const n=Number(t),c=xe.filter(b=>Number(b.parent)===n).map(b=>Number(b.id));return[n,...c]},[t,i,xe]),_e=s.useMemo(()=>{const n={};return l.forEach(c=>{n[Number(c.id)]=c}),n},[l]),I=s.useMemo(()=>g.filter(n=>Number(n.year)===Number(d?.year)&&Number(n.supplemental_round??0)===Number(d?.round??0)&&Te.includes(Number(n.organization))),[g,d?.year,d?.round,Te]),Ke=s.useMemo(()=>rn(I),[I]),Ue=s.useMemo(()=>{const n=S==="ALL"?I:I.filter(b=>(b.status||"DRAFT")===S);if(!m.trim())return n;const c=m.trim().toLowerCase();return n.filter(b=>String(b.id).includes(c)||String(b.subject_name||"").toLowerCase().includes(c)||String(b.subject_code||"").toLowerCase().includes(c)||String(b.organization_name||"").toLowerCase().includes(c))},[I,S,m]);s.useEffect(()=>{if(!I.length){P(null),B({}),z(!1);return}I.some(c=>Number(c.id)===Number(W))||(P(Number(I[0].id)),B({}))},[I,W]);const Qe=s.useMemo(()=>I.find(n=>Number(n.id)===Number(W))||null,[I,W]),Ye=s.useMemo(()=>I.map(n=>Number(n.id)).filter(n=>Number.isFinite(n)),[I]),{entryLogsById:Ae,newLogEntries:Je,recentWorkflowLogs:We,submissionInfoById:et,groupedSubmissions:J,clearNewLog:tt,clearNewLogsByEntryIds:ce,resetLogsState:$e}=sn({authAxios:o,scopeEntryIds:Ye,scopeEntries:I,filteredEntries:Ue,version:d});s.useEffect(()=>{$e()},[t,i,d?.id,$e]),s.useEffect(()=>{if(!J.length){$(""),H([]),z(!1);return}if(!M||!J.some(n=>n.key===M)){const n=J[0];$(n.key),n.entryIds.length&&P(Number(n.entryIds[0]))}},[J,M]);const ye=s.useMemo(()=>J.find(n=>n.key===M)||null,[J,M]),de=s.useMemo(()=>{if(!Q.length)return[];const n=new Set(Q.map(c=>Number(c)));return I.filter(c=>n.has(Number(c.id)))},[I,Q]),nt=de[0]||null,st=s.useMemo(()=>de.reduce((n,c)=>n+Number(c.total_amount||0),0),[de]);s.useEffect(()=>{if(D){if(!ye){z(!1);return}de.length||z(!1)}},[D,ye,de.length]);const G=s.useMemo(()=>{const n={DRAFT:0,PENDING:0,REVIEWING:0,FINALIZED:0};let c=0,b=0;return I.forEach(K=>{const V=K.status||"DRAFT";n[V]!=null&&(n[V]+=1);const re=Number(K.total_amount||0);(K.subject_type||_e[Number(K.subject)]?.subject_type)==="income"?c+=re:b+=re}),{statusCounts:n,totalEntries:I.length,incomeAmount:c,expenseAmount:b,diffAmount:c-b}},[I,_e]),rt=G.statusCounts.PENDING+G.statusCounts.REVIEWING,ot=n=>{if(!w)return;const c=ve.find(b=>String(b.id)===String(n));c&&w(c)},it=()=>{A("ALL"),v("")},at=s.useCallback((n,c)=>{Se(b=>({...b,[n]:c}))},[]),Me=s.useCallback(n=>{const c=Array.isArray(n?.entryIds)?n.entryIds.map(b=>Number(b)).filter(b=>Number.isFinite(b)):[Number(n)].filter(b=>Number.isFinite(b));c.length&&(n?.key&&$(n.key),H(c),P(c[0]),ce(c),z(!0))},[ce]),ze=s.useCallback(()=>{z(!1)},[]),Fe=s.useCallback(async(n,c="change")=>{const b=Array.isArray(n?.entryIds)?n.entryIds.map(R=>Number(R)).filter(R=>Number.isFinite(R)):[Number(n?.id)].filter(R=>Number.isFinite(R)),K=b.flatMap(R=>Ae[R]||[]).sort((R,Re)=>new Date(Re.created_at||0)-new Date(R.created_at||0)),V=c==="reject"?K.filter(me):K.filter(R=>!me(R));if(!V.length){await _.alert(N.noLogsMsg);return}const re=V.slice(0,20).map((R,Re)=>{const ut=R.actor_name||R.actor||"SYSTEM",ft=O[R.from_status]||R.from_status||"-",mt=O[R.to_status]||R.to_status||"-",Pe=String(R.reason||"").trim(),Ge=`${Re+1}. ${ge(R.created_at)} | ${ut} | ${ft} -> ${mt}`;return Pe?`${Ge} | ${Pe}`:Ge}),C=c==="reject"?N.rejectLogs:N.changeLogs,De=V.length>20?`
... ${N.all} ${V.length} ${N.totalItems}`:"",dt=n?.submitterId?`${n.submitterName||n.submitterId} (í•­ëª© ${n.entryCount||b.length}ê±´)`:n?.subject_name||n?.subject_code||n?.id||"-";await _.alert(`[${dt}] ${C}

${re.join(`
`)}${De}`),ce(b)},[Ae,_,ce]),lt={isAdmin:j,isReviewer:q,isManager:E,isRequestor:U,isVersionEditable:x,busyWorkflow:X,busySaveAll:ae,busyAddDetail:Ce,busyDeleteDetailId:Z,detailDraft:ie,selectedEntry:Qe,deptStatus:Ke,scopeEntries:I,entryLogsById:Ae,newLogEntries:Je,recentWorkflowLogs:We,summaryStats:G,subjectById:_e,workflowReasons:be,submissionInfoById:et,selectedSubmissionGroup:ye},Be={setSelectedTeamId:f,setSelectedDeptId:a,setStatusFilter:A,setSearchText:v,setSelectedEntryId:P,setDetailDraft:B,setBusyWorkflow:se,setBusySaveAll:pe,setBusyAddDetail:T,setBusyDeleteDetailId:Y,handleVersionChange:ot,resetFilters:it,setWorkflowReason:at,clearNewLog:tt,clearNewLogsByEntryIds:ce,openEntryHistoryLog:Fe,openEntryDetailModal:Me,closeEntryDetailModal:ze},ct=async()=>{if(!(!d||!t||!I.length))try{const n=await yt(()=>import("./xlsx-CNerDvZX.js"),[]),c=n.utils.book_new(),b=new Date,V=he.find(C=>String(C.id)===String(t))?.name||t,re=[{item:N.version,value:`${d.year} ${d.name||`Round ${d.round}`}`},{item:N.department,value:V},{item:N.generatedAt,value:b.toLocaleString("ko-KR")},{item:N.totalEntries,value:G.totalEntries},{item:N.incomeAmount,value:G.incomeAmount},{item:N.expenseAmount,value:G.expenseAmount},{item:N.diffAmount,value:G.diffAmount}];n.utils.book_append_sheet(c,n.utils.json_to_sheet(re),"Summary"),n.utils.book_append_sheet(c,n.utils.json_to_sheet(I.map((C,De)=>({no:De+1,id:C.id,status:O[C.status]||C.status,organization:C.organization_name||C.organization,subject_code:C.subject_code||"",subject_name:C.subject_name||C.subject,detail_count:C.details?.length||0,amount:Number(C.total_amount||0)}))),"Entries"),n.writeFile(c,`${Ot(V)}_budget_${d.year}_r${d.round}_${b.toISOString().slice(0,10)}.xlsx`),await _.alert(N.exportComplete)}catch(n){await _.alert(Oe(n,N.exportFail))}};return e.jsxs(xt,{menuId:r,user:h,stats:[{label:N.needReview,value:String(rt)},{label:N.finalized,value:String(G.statusCounts.FINALIZED)},{label:N.incomeTotal,value:ne(G.incomeAmount)},{label:N.expenseTotal,value:ne(G.expenseAmount)}],actions:[{label:N.exportWorkbook,onClick:ct,disabled:!t||!I.length}],children:[!d&&e.jsx(gt,{type:"warning",title:N.noVersionSelected,message:N.selectVersionMsg}),e.jsx(Ct,{version:d,versionOptions:ve,selectableDepartments:le,selectableTeams:we,selectedDeptId:t,selectedTeamId:i,statusFilter:S,searchText:m,canChangeDept:j,onChange:Be}),t?e.jsxs(e.Fragment,{children:[e.jsx(Kt,{pageState:lt,pageActions:Be,version:d,selectedDeptId:t,selectedTeamId:i,authAxios:o,modal:_,onRefreshEntries:u}),e.jsx("section",{style:{display:"grid",gap:12},children:e.jsx(Pt,{groups:J,selectedGroupKey:M,onSelectGroup:$,onOpenLog:Fe,onOpenDetail:Me})}),e.jsx(nn,{isOpen:D,selectedSubmissionGroup:ye,detailModalPrimaryEntry:nt,detailModalTotalAmount:st,detailEntryIds:Q,onClose:ze,authAxios:o,entries:g,subjects:l,orgs:p,projects:k,onRefreshEntries:u,modal:_,version:d,versions:y,setVersion:w,user:h,selectedDeptId:t,selectedTeamId:i}),e.jsx(tn,{logs:We})]}):e.jsx(Ee,{icon:"!",title:N.selectDeptTitle,message:N.selectDeptMsg})]})}export{yn as default};
