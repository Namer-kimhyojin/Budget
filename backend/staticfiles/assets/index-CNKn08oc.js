import{c as q,j as e,a as c,m as ue,f as me,S as Ve,e as Ge,g as qe,R as Re,M as He,h as U}from"./index-7aZPMBWo.js";import{P as Ye,F as Te,T as Xe}from"./triangle-alert-B907Gry6.js";import{C as de,T as le,X as Ke}from"./x-C3a4jUmy.js";import{E as Ee,D as je,L as Ze,C as Je,a as Qe,P as et}from"./paperclip-DXpCBuuz.js";import{P as Ie}from"./pen-CjQFylpv.js";import{S as tt}from"./StatusBadge-BFrDIW-9.js";import{D as nt,T as rt}from"./trending-up-BItFLUFH.js";import{C as st}from"./chevron-down-Co5Wl8S6.js";const ot=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],lt=q("arrow-left",ot);const it=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],at=q("arrow-up-down",it);const dt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],De=q("calendar",dt);const ct=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],ce=q("circle-pause",ct);const ft=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],fe=q("circle-play",ft);const pt=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],ut=q("hash",pt);const xt=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],gt=q("layout-grid",xt);const ht=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],bt=q("list",ht);const yt=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],mt=q("square-check-big",yt);function ke({isOpen:t,onClose:o,title:s,children:_,footer:x,width:j=500}){return t?e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:20},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:16,width:"100%",maxWidth:j,boxShadow:"0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04)",display:"flex",flexDirection:"column",maxHeight:"90vh"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:800,color:"#0f172a"},children:s}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#94a3b8",lineHeight:1},children:"×"})]}),e.jsx("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:_}),x&&e.jsx("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",gap:12,backgroundColor:"#f8fafc",borderBottomLeftRadius:16,borderBottomRightRadius:16},children:x})]})}):null}const{simpleSelect:jt}=ue,ie={DRAFT:{label:"대기중",color:"#64748b",bg:"#f1f5f9",border:"#e2e8f0",dot:"#94a3b8"},PENDING:{label:"접수중",color:"#1d4ed8",bg:"#eff6ff",border:"#bfdbfe",dot:"#3b82f6"},EXPIRED:{label:"접수마감",color:"#c2410c",bg:"#ffedd5",border:"#fdba74",dot:"#f97316"},CONFIRMED:{label:"확정",color:"#065f46",bg:"#ecfdf5",border:"#a7f3d0",dot:"#10b981"},CLOSED:{label:"마감",color:"#92400e",bg:"#fffbeb",border:"#fde68a",dot:"#f59e0b"}},Se={DRAFT:1,PENDING:2,EXPIRED:3,CONFIRMED:4,CLOSED:5},_e=t=>["PENDING","DRAFT","EXPIRED"].includes(String(t||"").toUpperCase()),ee=t=>{if(!t)return 0;const o=new Date(t).getTime();return Number.isFinite(o)?o:0};function ae(t,o){const s=_e(t.status)?1:0,_=_e(o.status)?1:0;return _!==s?_-s:o.year!==t.year?o.year-t.year:(o.round||0)!==(t.round||0)?(o.round||0)-(t.round||0):String(t.id).localeCompare(String(o.id))}function pe(t){if(!t)return null;const o=new Date(t);o.setHours(23,59,59,999);const s=Math.ceil((o-Date.now())/864e5);return s===0?{label:"D-Day",color:"#dc2626",bg:"#fef2f2",border:"#fca5a5"}:s>0&&s<=3?{label:`D-${s}`,color:"#ea580c",bg:"#fff7ed",border:"#fed7aa"}:s>0&&s<=7?{label:`D-${s}`,color:"#ca8a04",bg:"#fefce8",border:"#fde68a"}:s>0?{label:`D-${s}`,color:"#16a34a",bg:"#f0fdf4",border:"#bbf7d0"}:{label:`D+${Math.abs(s)}`,color:"#94a3b8",bg:"#f1f5f9",border:"#e2e8f0"}}function kt({item:t,rank:o,canManage:s,handleGoDetail:_,setVersion:x,setIsEditModalOpen:j,handleCloseVersion:L,handleReopenVersion:f,handleDeleteVersion:P,progressData:M,summaryVersionId:m,isSelected:i,onToggleSelect:y}){const w=t.status==="PENDING"||t.status==="DRAFT"||t.status==="EXPIRED",R=t.status==="CLOSED",E=ie[t.status]||ie.DRAFT,B=pe(t.end_date),I=c.useMemo(()=>{if(!M?.length||m!==t.id)return null;const D=M.length;if(!D)return null;const W=M.filter(p=>p.dept_status==="COMPLETED").length,H=M.filter(p=>["WRITING","SUBMITTED"].includes(p.dept_status)).length;return{total:D,completed:W,inProgress:H,pct:Math.round(W/D*100)}},[M,m,t.id]);return e.jsxs("div",{style:{background:"#fff",borderRadius:16,border:w?`2px solid ${E.border}`:"1px solid #e2e8f0",boxShadow:w?"0 4px 20px rgba(37,99,235,0.10), 0 1px 4px rgba(0,0,0,0.04)":"0 1px 4px rgba(0,0,0,0.04)",display:"flex",flexDirection:"column",overflow:"hidden",transition:"box-shadow 0.2s, transform 0.2s",opacity:R?.72:1,position:"relative"},onMouseEnter:D=>{D.currentTarget.style.boxShadow="0 8px 30px rgba(0,0,0,0.10)",D.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:D=>{D.currentTarget.style.boxShadow=w?"0 4px 20px rgba(37,99,235,0.10)":"0 1px 4px rgba(0,0,0,0.04)",D.currentTarget.style.transform="none"},children:[e.jsx("div",{style:{height:4,background:w?"linear-gradient(90deg, #2563eb, #60a5fa)":E.dot,borderRadius:"16px 16px 0 0"}}),e.jsxs("div",{style:{padding:"18px 20px",flex:1,display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700,color:"#94a3b8",letterSpacing:"0.06em",marginBottom:2},children:[t.year,"년도 · ",o,"번째 예산"]}),e.jsx("div",{style:{fontSize:17,fontWeight:900,color:"#0f172a",lineHeight:1.2},children:t.name})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4,flexShrink:0},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:11,fontWeight:700,padding:"3px 9px",borderRadius:999,background:E.bg,color:E.color,border:`1px solid ${E.border}`},children:[e.jsx("span",{style:{width:6,height:6,borderRadius:"50%",background:E.dot,display:"inline-block"}}),E.label]}),w&&B&&e.jsx("span",{style:{fontSize:11,fontWeight:800,padding:"2px 8px",borderRadius:999,background:B.bg,color:B.color,border:`1px solid ${B.border}`},children:B.label})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#64748b"},children:[e.jsx(De,{size:13,style:{flexShrink:0}}),t.start_date?e.jsxs("span",{children:[e.jsx("b",{style:{color:"#334155"},children:t.start_date})," ~ ",e.jsx("b",{style:{color:"#334155"},children:t.end_date})]}):e.jsx("span",{style:{color:"#cbd5e1"},children:"기간 미설정"})]}),t.guidelines&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,color:"#2563eb",background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:6,padding:"4px 10px",alignSelf:"flex-start"},children:[e.jsx(Te,{size:11})," 작성 지침 있음"]}),I&&e.jsxs("div",{style:{marginTop:2},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#64748b",marginBottom:5},children:[e.jsx("span",{children:"부서 편성 현황"}),e.jsxs("span",{style:{fontWeight:800,color:I.pct===100?"#059669":"#2563eb"},children:[I.completed,"/",I.total," (",I.pct,"%)"]})]}),e.jsx("div",{style:{height:6,borderRadius:99,background:"#f1f5f9",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:I.pct===100?"linear-gradient(90deg,#10b981,#059669)":"linear-gradient(90deg,#60a5fa,#2563eb)",width:`${I.pct}%`,transition:"width 0.5s ease"}})}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:5,fontSize:11},children:[e.jsxs("span",{style:{color:"#059669",fontWeight:700},children:["✓ 완료 ",I.completed]}),e.jsxs("span",{style:{color:"#d97706",fontWeight:700},children:["⏳ 진행 ",I.inProgress]}),e.jsxs("span",{style:{color:"#94a3b8"},children:["○ 미시작 ",I.total-I.completed-I.inProgress]})]})]})]}),e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",padding:"10px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,background:i?"#f0f7ff":"#fafbfc",transition:"background 0.2s"},children:[s&&e.jsx("div",{onClick:D=>{D.stopPropagation(),y()},style:{width:18,height:18,borderRadius:5,background:i?"#2563eb":"#fff",border:`2px solid ${i?"#2563eb":"#cbd5e1"}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.15s",boxShadow:i?"0 2px 6px rgba(37,99,235,0.25)":"none"},title:i?"선택 해제":"일괄 작업용 선택",children:i&&e.jsx(de,{size:12,color:"#fff",strokeWidth:4})}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{display:"flex",gap:4,flexShrink:0},children:[e.jsx(V,{title:"상세 보기",color:"#2563eb",bg:"#eff6ff",onClick:()=>_(t),children:e.jsx(Ee,{size:13})}),s&&e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"수정",color:"#0369a1",bg:"#f0f9ff",onClick:()=>{x(t),j(!0)},children:e.jsx(Ie,{size:13})}),R?e.jsx(V,{title:"마감 해제",color:"#059669",bg:"#ecfdf5",onClick:()=>f(t),children:e.jsx(fe,{size:13})}):e.jsx(V,{title:"회차 마감",color:"#b45309",bg:"#fffbeb",onClick:()=>L(t),children:e.jsx(ce,{size:13})}),e.jsx(V,{title:"삭제",color:"#dc2626",bg:"#fef2f2",onClick:()=>P(t),children:e.jsx(le,{size:13})})]})]})]})]})}function V({children:t,title:o,color:s,bg:_,onClick:x}){const[j,L]=c.useState(!1);return e.jsx("button",{title:o,onClick:x,onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),style:{width:30,height:30,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${j?s:"#e2e8f0"}`,borderRadius:8,background:j?_:"#fff",color:j?s:"#64748b",cursor:"pointer",transition:"all 0.15s"},children:t})}function St({versions:t,setVersion:o,canManage:s,statusById:_,handleGoDetail:x,setIsEditModalOpen:j,handleCloseVersion:L,handleReopenVersion:f,handleDeleteVersion:P,setIsCreateModalOpen:M,progressData:m=[],summaryVersionId:i,handleBatchDelete:y,handleBatchUpdateStatus:w}){const[R,E]=c.useState([]),B=n=>{E(u=>u.includes(n)?u.filter(h=>h!==n):[...u,n])},I=()=>{R.length===t.length&&t.length>0?E([]):E(t.map(n=>n.id))},D=c.useMemo(()=>t.find(n=>n.id===i)||t.find(n=>n.status==="PENDING")||t.find(n=>n.status==="DRAFT")||null,[t,i]);D&&pe(D.end_date),c.useMemo(()=>{if(!m.length)return{completed:0,inProgress:0,notStarted:0,total:0};const n=m.filter(b=>b.dept_status==="COMPLETED").length,u=m.filter(b=>["WRITING","SUBMITTED"].includes(b.dept_status)).length,h=m.filter(b=>["NOT_STARTED","EMPTY"].includes(b.dept_status)).length;return{completed:n,inProgress:u,notStarted:h,total:m.length}},[m]),c.useMemo(()=>{const n={DRAFT:0,PENDING:0,CONFIRMED:0,CLOSED:0};return t.forEach(u=>{const h=String(_[u.id]||u.status||"").toUpperCase();n[h]!==void 0&&n[h]++}),{total:t.length,...n}},[t,_]),c.useMemo(()=>m.reduce((n,u)=>n+Number(u.total_entries||0),0),[m]),c.useMemo(()=>m.reduce((n,u)=>n+Number(u.total_amount||0),0),[m]);const[W,H]=c.useState("card"),[p,a]=c.useState("active_year"),[g,k]=c.useState("desc"),v=[{value:"active_year",label:"기본(활성/연도)"},{value:"year",label:"연도"},{value:"round",label:"회차"},{value:"name",label:"예산명"},{value:"status",label:"상태"},{value:"start_date",label:"시작일"},{value:"end_date",label:"종료일"},{value:"created_at",label:"생성일"}],F=()=>k(n=>n==="asc"?"desc":"asc"),z=n=>{if(p===n){F();return}a(n),k("desc")},S=n=>p===n?g==="asc"?" ^":" v":" -",O=c.useMemo(()=>{const n=[...t];return n.sort((u,h)=>{let b=0;if(p==="active_year")return b=ae(u,h),g==="asc"?-b:b;switch(p){case"year":b=Number(u.year||0)-Number(h.year||0);break;case"round":b=Number(u.round||0)-Number(h.round||0);break;case"name":b=String(u.name||"").localeCompare(String(h.name||""),"ko");break;case"status":b=Number(Se[u.status]||99)-Number(Se[h.status]||99);break;case"start_date":b=ee(u.start_date)-ee(h.start_date);break;case"end_date":b=ee(u.end_date)-ee(h.end_date);break;case"created_at":b=ee(u.created_at)-ee(h.created_at);break;default:return b=ae(u,h),g==="asc"?-b:b}return b===0&&(b=ae(u,h)),g==="asc"?b:-b}),n},[t,g,p]),T=c.useMemo(()=>{const n={},u={};return t.forEach(h=>{u[h.year]||(u[h.year]=[]),u[h.year].push(h)}),Object.keys(u).forEach(h=>{u[h].sort((b,J)=>(b.round||0)-(J.round||0)||String(b.id).localeCompare(String(J.id))),u[h].forEach((b,J)=>n[b.id]=J+1)}),n},[t]),A={textAlign:"left",borderBottom:"1px solid #e2e8f0",color:"#64748b",fontWeight:700,padding:"10px 12px",fontSize:12,background:"#f8fafc",whiteSpace:"nowrap"},N={...A,cursor:"pointer",userSelect:"none"},$={borderBottom:"1px solid #f1f5f9",padding:"10px 12px",color:"#334155",fontSize:13,verticalAlign:"middle"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14,gap:12,flexWrap:"wrap"},children:[e.jsxs("h3",{style:{margin:0,fontSize:15,fontWeight:800,color:"#0f172a"},children:["예산서 목록",e.jsxs("span",{style:{marginLeft:8,fontSize:12,fontWeight:600,color:"#94a3b8"},children:["(",t.length,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"inline-flex",border:"1px solid #cbd5e1",borderRadius:10,overflow:"hidden",background:"#fff"},children:[e.jsxs("button",{type:"button",onClick:()=>H("card"),style:{border:"none",padding:"8px 10px",background:W==="card"?"#eff6ff":"#fff",color:W==="card"?"#1d4ed8":"#64748b",fontWeight:700,fontSize:12,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:5},title:"카드 보기",children:[e.jsx(gt,{size:14})," 카드"]}),e.jsxs("button",{type:"button",onClick:()=>H("list"),style:{border:"none",borderLeft:"1px solid #e2e8f0",padding:"8px 10px",background:W==="list"?"#eff6ff":"#fff",color:W==="list"?"#1d4ed8":"#64748b",fontWeight:700,fontSize:12,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:5},title:"목록 보기",children:[e.jsx(bt,{size:14})," 목록"]})]}),e.jsx("select",{value:p,onChange:n=>a(n.target.value),style:{...jt,minWidth:190,fontSize:12,padding:"8px 10px"},title:"정렬 항목",children:v.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsxs("button",{type:"button",onClick:F,style:{border:"1px solid #cbd5e1",borderRadius:8,background:"#fff",padding:"8px 10px",fontSize:12,fontWeight:700,color:"#334155",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:6},title:"정렬 방향 전환",children:[e.jsx(at,{size:13}),g==="asc"?"오름차순":"내림차순"]}),s&&e.jsxs("button",{onClick:()=>M(!0),style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:10,background:"linear-gradient(135deg,#2563eb,#3b82f6)",color:"#fff",border:"none",cursor:"pointer",fontSize:13,fontWeight:700,boxShadow:"0 2px 8px rgba(37,99,235,0.25)"},children:[e.jsx(Ye,{size:14})," 신규 예산서 접수"]})]})]}),t.length===0?e.jsx("div",{style:{textAlign:"center",padding:"48px 24px",background:"#fff",borderRadius:16,border:"1px dashed #e2e8f0",color:"#94a3b8",fontSize:13},children:"접수된 예산서가 없습니다. 신규 예산서를 생성해 주세요."}):W==="card"?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16},children:O.map(n=>e.jsx(kt,{item:n,rank:T[n.id],canManage:s,handleGoDetail:x,setVersion:o,setIsEditModalOpen:j,handleDeleteVersion:P,progressData:m,summaryVersionId:i,isSelected:R.includes(n.id),onToggleSelect:()=>B(n.id)},n.id))}):e.jsx("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:920},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[s&&e.jsx("th",{style:{...A,width:40,textAlign:"center"},children:e.jsx("div",{onClick:I,style:{width:18,height:18,borderRadius:4,background:R.length===t.length&&t.length>0?"#2563eb":"#fff",border:`2px solid ${R.length===t.length&&t.length>0?"#2563eb":"#cbd5e1"}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",margin:"0 auto"},children:R.length===t.length&&t.length>0&&e.jsx(de,{size:12,color:"#fff",strokeWidth:4})})}),e.jsxs("th",{style:N,onClick:()=>z("name"),children:["예산명",S("name")]}),e.jsxs("th",{style:N,onClick:()=>z("year"),children:["연도",S("year")]}),e.jsxs("th",{style:N,onClick:()=>z("round"),children:["회차",S("round")]}),e.jsxs("th",{style:N,onClick:()=>z("status"),children:["상태",S("status")]}),e.jsxs("th",{style:N,onClick:()=>z("start_date"),children:["시작일",S("start_date")]}),e.jsxs("th",{style:N,onClick:()=>z("end_date"),children:["종료일",S("end_date")]}),e.jsx("th",{style:{...A,width:110},children:"D-day"}),e.jsx("th",{style:{...A,width:110},children:"지침"}),e.jsx("th",{style:{...A,width:150,textAlign:"center"},children:"관리"})]})}),e.jsx("tbody",{children:O.map(n=>{const u=ie[n.status]||ie.DRAFT,h=pe(n.end_date),b=n.status==="CLOSED";return e.jsxs("tr",{style:{opacity:b?.72:1,background:R.includes(n.id)?"#eff6ff":"transparent"},children:[s&&e.jsx("td",{style:{...$,textAlign:"center"},children:e.jsx("div",{onClick:()=>B(n.id),style:{width:18,height:18,borderRadius:4,background:R.includes(n.id)?"#2563eb":"#fff",border:`2px solid ${R.includes(n.id)?"#2563eb":"#cbd5e1"}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",margin:"0 auto"},children:R.includes(n.id)&&e.jsx(de,{size:12,color:"#fff",strokeWidth:4})})}),e.jsx("td",{style:$,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("strong",{style:{color:"#0f172a"},children:n.name}),e.jsxs("span",{style:{fontSize:11,color:"#94a3b8"},children:["ID ",n.id]})]})}),e.jsx("td",{style:$,children:n.year}),e.jsx("td",{style:$,children:n.round??0}),e.jsx("td",{style:$,children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:999,background:u.bg,color:u.color,border:"1px solid "+u.border,fontSize:11,fontWeight:700},children:[e.jsx("span",{style:{width:6,height:6,borderRadius:"50%",background:u.dot,display:"inline-block"}}),u.label]})}),e.jsx("td",{style:$,children:n.start_date||"-"}),e.jsx("td",{style:$,children:n.end_date||"-"}),e.jsx("td",{style:$,children:h?e.jsx("span",{style:{fontSize:11,fontWeight:800,padding:"2px 8px",borderRadius:999,background:h.bg,color:h.color,border:"1px solid "+h.border},children:h.label}):"-"}),e.jsx("td",{style:$,children:n.guidelines?e.jsx("span",{style:{color:"#1d4ed8",fontWeight:700,fontSize:12},children:"있음"}):e.jsx("span",{style:{color:"#94a3b8",fontSize:12},children:"없음"})}),e.jsx("td",{style:{...$,textAlign:"center"},children:e.jsxs("div",{style:{display:"inline-flex",gap:4},children:[e.jsx(V,{title:"상세 보기",color:"#2563eb",bg:"#eff6ff",onClick:()=>x(n),children:e.jsx(Ee,{size:13})}),s&&e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"수정",color:"#0369a1",bg:"#f0f9ff",onClick:()=>{o(n),j(!0)},children:e.jsx(Ie,{size:13})}),b?e.jsx(V,{title:"재개",color:"#059669",bg:"#ecfdf5",onClick:()=>f(n),children:e.jsx(fe,{size:13})}):e.jsx(V,{title:"마감",color:"#b45309",bg:"#fffbeb",onClick:()=>L(n),children:e.jsx(ce,{size:13})}),e.jsx(V,{title:"삭제",color:"#dc2626",bg:"#fef2f2",onClick:()=>P(n),children:e.jsx(le,{size:13})})]})]})})]},n.id)})})]})})]}),s&&R.length>0&&e.jsxs("div",{style:{position:"fixed",bottom:30,left:"50%",transform:"translateX(-50%)",zIndex:1e3,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(12px)",padding:"10px 14px 10px 20px",borderRadius:20,border:"1px solid #cbd5e1",boxShadow:"0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:16,animation:"slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:[e.jsx("style",{children:`
                        @keyframes slideUp {
                            from { transform: translate(-50%, 100%) scale(0.9); opacity: 0; }
                            to { transform: translate(-50%, 0) scale(1); opacity: 1; }
                        }
                    `}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:8,background:"#eff6ff",color:"#2563eb",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(mt,{size:16})}),e.jsxs("span",{style:{fontSize:14,fontWeight:800,color:"#334155"},children:[e.jsxs("span",{style:{color:"#2563eb"},children:[R.length,"개"]})," 선택됨"]})]}),e.jsx("div",{style:{width:1,height:24,background:"#e2e8f0"}}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:async()=>{w(R,"PENDING"),E([])},style:{background:"#fff",border:"1px solid #e2e8f0",color:"#334155",padding:"8px 16px",borderRadius:10,fontSize:13,fontWeight:700,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6,boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},onMouseEnter:n=>{n.currentTarget.style.background="#f8fafc",n.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:n=>{n.currentTarget.style.background="#fff",n.currentTarget.style.borderColor="#e2e8f0"},children:[e.jsx(fe,{size:15,style:{color:"#2563eb"}})," 접수 개시"]}),e.jsxs("button",{onClick:async()=>{w(R,"CLOSED"),E([])},style:{background:"#fff",border:"1px solid #e2e8f0",color:"#334155",padding:"8px 16px",borderRadius:10,fontSize:13,fontWeight:700,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6,boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},onMouseEnter:n=>{n.currentTarget.style.background="#f8fafc",n.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:n=>{n.currentTarget.style.background="#fff",n.currentTarget.style.borderColor="#e2e8f0"},children:[e.jsx(ce,{size:15,style:{color:"#f59e0b"}})," 일괄 마감"]}),e.jsxs("button",{onClick:async()=>{await y(R),E([])},style:{background:"#ef4444",border:"none",color:"#fff",padding:"8px 16px",borderRadius:10,fontSize:13,fontWeight:800,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6,boxShadow:"0 4px 6px -1px rgba(239,68,68,0.2)"},onMouseEnter:n=>{n.currentTarget.style.background="#dc2626"},onMouseLeave:n=>{n.currentTarget.style.background="#ef4444"},children:[e.jsx(le,{size:15})," 일괄 삭제"]})]}),e.jsx("div",{style:{width:1,height:24,background:"#e2e8f0",marginLeft:4}}),e.jsx("button",{onClick:()=>E([]),style:{background:"transparent",border:"none",color:"#94a3b8",padding:"8px",cursor:"pointer",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:n=>{n.currentTarget.style.background="#f1f5f9",n.currentTarget.style.color="#64748b"},onMouseLeave:n=>{n.currentTarget.style.background="transparent",n.currentTarget.style.color="#94a3b8"},title:"선택 해제",children:e.jsx(Ke,{size:18})})]})]})}const l={pageTitle:"접수 관리",listTitle:"접수 목록",detailTitle:"접수 상세",masterTitle:"예산서 마스터",roundDetail:"회차 상세",round:"회차",inputPeriod:"입력 기간",newRoundBtn:"신규 예산서 접수",editRoundBtn:"회차 정보 수정",refreshStatus:"현황 새로고침",goToList:"목록으로",progressByDept:"부서별 진행 현황",bulkUploadTitle:"예산 항목 일괄 등록",exportOfficialBook:"공식 예산서 출력",no:"번호",year:"연도",name:"예산명",period:"기간",status:"상태",currentStatus:"현재 상태",statusControl:"상태 제어",management:"관리",dept:"부서",entryCount:"항목 수",totalAmount:"예산 합계",sourceRound:"기초데이터 원본",draft:"준비중",pending:"제출대기",confirmed:"확정",closed:"마감",active:"진행",applyYear:"적용 연도",roundName:"예산명칭",createMode:"기초데이터 설정",newCreate:"빈 상태로 시작",copyRound:"기존 회차 불러오기",originalRound:"불러올 회차",selectOriginal:"원본 회차 선택",copyNotice:"불러온 데이터는 당초 예산액 기준으로 저장되며, 증감액은 현예산액과 기존 예산액의 차이로 표시됩니다.",periodSetting:"입력 접수 기간 설정",guidelinesLabel:"부서별 작성 지침(공통)",guidelinesPlaceholder:"예산 작성 시 부서에서 참고할 지침을 입력하세요.",fileUploadLabel:"첨부 파일 등록",currentFile:"현재 파일: ",uploadPlaceholder:"파일을 드래그하거나 클릭하여 업로드하세요.",removeFile:"파일 제거",searchPlaceholder:"사업명 검색..",namePlaceholder:"예: 2027년 본예산",bulkFormat:"형식: `subject_code, org_code, name, price, qty` (콤마 구분, 줄 단위)",bulkExample:"예: 1101, D001, 사무용품, 50000, 2",noData:"표시할 데이터가 없습니다.",noProgressData:"표시할 진행 현황 데이터가 없습니다.",loadingProgress:"진행 현황을 불러오는 중...",periodUndefined:"기간 미정",save:"저장",cancel:"취소",delete:"삭제",deactivate:"비활성화",edit:"수정",view:"보기",upload:"업로드 실행",confirmDelete:t=>`"${t}" 버전을 삭제하시겠습니까? 관련 데이터도 모두 삭제됩니다.`,deleteSuccess:"삭제했습니다.",deleteFail:"삭제 실패",alreadyClosed:"이미 마감된 버전입니다.",confirmDeactivate:t=>`"${t}" 버전을 비활성화(마감)하시겠습니까?`,deactivateSuccess:"비활성화했습니다.",changeFail:"변경 실패",transferRequired:"기초데이터 불러오기를 선택한 경우 원본 회차를 선택해야 합니다.",newRoundName:t=>`${t}년 신규 회차`,createSuccess:t=>`신규 예산서가 접수되었습니다.${t>0?`
불러온 항목: ${t.toLocaleString()}건`:""}`,createFail:"생성 실패",updateSuccess:"버전 정보가 업데이트되었습니다.",updateFail:"상태 변경 실패",saveSuccess:"버전 정보가 저장되었습니다.",saveFail:"저장 실패",inputRequired:"항목을 입력해 주세요.",uploadSuccess:(t,o)=>`업로드 완료: ${t} 생성, ${o} 업데이트`,uploadFail:"업로드 실패",exportOfficialBookDone:"공식 예산서 파일을 다운로드했습니다.",exportOfficialBookFail:"공식 예산서 출력 중 오류가 발생했습니다.",sourceVersionEmpty:"선택한 원본 회차에 예산 항목이 없습니다. 다른 회차를 선택하거나 빈 상태로 시작하세요.",closeSuccess:"회차를 마감했습니다.",closeFail:"마감 처리 중 오류가 발생했습니다.",reopenSuccess:"마감을 해제했습니다.",reopenFail:"마감 해제 중 오류가 발생했습니다.",confirmClose:t=>`"${t}" 회차를 마감합니까?
마감 후에는 모든 편집이 잠깁니다.`,confirmReopen:t=>`"${t}" 회차의 마감을 해제합니까?`,summaryTotalRounds:"전체 예산서",summaryActiveRound:"진행 중 회차",summaryDeptStatus:"부서 현황",summaryCompleted:"완료",summaryInProgress:"진행중",summaryNotStarted:"미시작",summaryTotalEntries:"전체 항목",summaryTotalAmount:"합계 금액",summaryDeadline:"마감 기한",summaryNoPending:"진행 중인 회차 없음",totalEntries:"전체 항목 수",totalSum:"전체 예산 합계"},{menuGhostBtn:_t}=ue,te={..._t,padding:"8px 14px",borderRadius:10,fontSize:13,fontWeight:700,display:"inline-flex",alignItems:"center",gap:6},we=t=>{if(!t)return"-";const o=new Date(t);return Number.isNaN(o.getTime())?String(t):o.toLocaleDateString("ko-KR")},se={COMPLETED:{bg:"#f0fdf4",border:"#bbf7d0",color:"#166534",barColor:"#10b981",label:"완료"},SUBMITTED:{bg:"#eff6ff",border:"#bfdbfe",color:"#1d4ed8",barColor:"#3b82f6",label:"제출됨"},WRITING:{bg:"#fffbeb",border:"#fde68a",color:"#b45309",barColor:"#f59e0b",label:"작성중"},NOT_STARTED:{bg:"#f8fafc",border:"#e2e8f0",color:"#94a3b8",barColor:"#cbd5e1",label:"미시작"},EMPTY:{bg:"#f8fafc",border:"#e2e8f0",color:"#cbd5e1",barColor:"#e2e8f0",label:"항목없음"}};function wt(t){if(!t.length)return 0;const o=t.filter(s=>s.dept_status==="COMPLETED").length;return Math.round(o/t.length*100)}function ne({icon:t,iconColor:o,iconBg:s,label:_,value:x,sub:j}){return e.jsxs("div",{style:{background:"#fff",border:"1px solid #e8edf5",borderRadius:14,padding:"14px 18px",display:"flex",alignItems:"flex-start",gap:14,boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:10,background:s,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:Re.cloneElement(t,{size:17,style:{color:o}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#94a3b8",letterSpacing:"0.04em",marginBottom:3},children:_}),e.jsx("div",{style:{fontSize:15,fontWeight:800,color:"#0f172a",lineHeight:1.3},children:x}),j&&e.jsx("div",{style:{marginTop:4},children:j})]})]})}function Ct({rate:t}){const o=t===100?"#059669":t>=60?"#2563eb":"#f59e0b",s=t===100?"#ecfdf5":t>=60?"#eff6ff":"#fffbeb";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,background:s,border:`1px solid ${o}22`,borderRadius:12,padding:"10px 16px"},children:[e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{height:8,borderRadius:99,background:"#e2e8f0",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:t===100?"linear-gradient(90deg,#10b981,#059669)":"linear-gradient(90deg,#60a5fa,#2563eb)",width:`${t}%`,transition:"width 0.5s ease"}})})}),e.jsxs("span",{style:{fontSize:15,fontWeight:900,color:o,minWidth:44,textAlign:"right"},children:[t,"%"]})]})}function vt({version:t,canManage:o,setViewMode:s,fetchProgress:_,progressData:x=[],loadingProgress:j,setIsEditModalOpen:L,onExportBudgetBook:f,onClose:P,onReopen:M}){const m=x.reduce((p,a)=>p+Number(a.total_entries||0),0),i=x.reduce((p,a)=>p+Number(a.total_amount||0),0),y=wt(x),w=t?.status==="CLOSED",[R,E]=c.useState({}),B=p=>E(a=>({...a,[p]:!a[p]})),I=x.filter(p=>p.dept_status==="COMPLETED").length,D=x.filter(p=>["WRITING","SUBMITTED"].includes(p.dept_status)).length,W=c.useMemo(()=>{const p={};return x.forEach(a=>{const g=a.org_id,k=a.parent_id,v=k||g;p[v]||(p[v]={dept:null,teams:[]}),k?p[v].teams.push({...a}):p[v].dept={...a}}),Object.values(p).map(a=>{if(!a.dept){if(!a.teams.length)return null;a.dept={...a.teams[0],org_name:`${a.teams[0].org_name} (그룹)`,isPlaceholder:!0}}if(a.teams.length>0){const g=a.teams.reduce((v,F)=>(v.total_entries+=Number(F.total_entries||0),v.total_amount+=Number(F.total_amount||0),v.finalized+=Number(F.status_counts?.FINALIZED||0),v),{total_entries:Number(a.dept.total_entries||0),total_amount:Number(a.dept.total_amount||0),finalized:Number(a.dept.status_counts?.FINALIZED||0)});a.dept.total_entries=g.total_entries,a.dept.total_amount=g.total_amount;const k=g.total_entries>0?Math.round(g.finalized/g.total_entries*100):0;a.dept.aggregatedBarPct=k,g.total_entries>0&&(k===100?a.dept.dept_status="COMPLETED":k>0?a.dept.dept_status="SUBMITTED":a.dept.dept_status="WRITING")}else{const g=Number(a.dept.total_entries||0),k=Number(a.dept.status_counts?.FINALIZED||0);a.dept.aggregatedBarPct=g>0?Math.round(k/g*100):0}return a}).filter(Boolean).sort((a,g)=>(a.dept.org_name||"").localeCompare(g.dept.org_name||""))},[x]),H=p=>{window.location.assign(`/api/versions/${t.id}/export-department-budget/?org_id=${p}`)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:10,background:"#fff",border:"1px solid #e2e8f0",borderRadius:14,padding:"14px 20px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("button",{type:"button",style:te,onClick:()=>s("list"),children:[e.jsx(lt,{size:14})," ",l.goToList]}),e.jsx("div",{style:{width:1,height:20,background:"#e2e8f0"}}),e.jsxs("span",{style:{fontSize:15,fontWeight:800,color:"#0f172a"},children:[t?.year,"년 ",t?.name]}),e.jsx(tt,{status:t?.status,type:"version"})]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:te,onClick:()=>_(),children:[e.jsx(me,{size:14})," ",l.refreshStatus]}),e.jsxs("button",{type:"button",style:te,onClick:f,children:[e.jsx(je,{size:14})," ",l.exportOfficialBook]}),o&&e.jsxs("button",{type:"button",style:te,onClick:()=>L(!0),children:[e.jsx(Ve,{size:14})," ",l.editRoundBtn]}),o&&t&&(w?e.jsxs("button",{type:"button",onClick:()=>M?.(t),style:{...te,border:"1px solid #86efac",background:"#f0fdf4",color:"#166534"},children:[e.jsx(Ze,{size:14})," 마감 해제"]}):e.jsxs("button",{type:"button",onClick:()=>P?.(t),style:{...te,border:"1px solid #fca5a5",background:"#fff1f2",color:"#b91c1c"},children:[e.jsx(Ge,{size:14})," 회차 마감"]}))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:12},children:[e.jsx(ne,{icon:e.jsx(ut,{}),iconColor:"#6366f1",iconBg:"#eef2ff",label:"예산 회차",value:`${t?.year}년 / ${t?.name||`${t?.round??0}차`}`}),e.jsx(ne,{icon:e.jsx(De,{}),iconColor:"#0ea5e9",iconBg:"#f0f9ff",label:"입력 기간",value:`${we(t?.start_date)} ~ ${we(t?.end_date)}`}),e.jsx(ne,{icon:e.jsx(Te,{}),iconColor:"#f59e0b",iconBg:"#fffbeb",label:"총 예산 항목",value:`${m.toLocaleString()}건`}),e.jsx(ne,{icon:e.jsx(nt,{}),iconColor:"#10b981",iconBg:"#ecfdf5",label:"총 예산 금액",value:i>0?`${i.toLocaleString()}원`:"집계 전"}),e.jsx(ne,{icon:e.jsx(Je,{}),iconColor:"#059669",iconBg:"#ecfdf5",label:"부서 완료 현황",value:x.length>0?`${I} / ${x.length}`:"—",sub:x.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,fontSize:11},children:[e.jsxs("span",{style:{color:"#059669",fontWeight:700},children:["완료 ",I]}),e.jsxs("span",{style:{color:"#d97706",fontWeight:700},children:["진행 ",D]}),e.jsxs("span",{style:{color:"#94a3b8"},children:["미시작 ",x.length-I-D]})]})}),e.jsx(ne,{icon:e.jsx(rt,{}),iconColor:"#2563eb",iconBg:"#eff6ff",label:"전체 완료율",value:x.length>0?`${y}%`:"—",sub:x.length>0&&e.jsx("div",{style:{height:5,borderRadius:99,background:"#e2e8f0",overflow:"hidden",marginTop:6},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:y===100?"linear-gradient(90deg,#10b981,#059669)":"linear-gradient(90deg,#60a5fa,#2563eb)",width:`${y}%`,transition:"width 0.5s"}})})})]}),e.jsxs("div",{style:{background:"#fff",border:"1px solid #e2e8f0",borderRadius:16,overflow:"hidden",boxShadow:"0 1px 4px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{padding:"16px 22px",borderBottom:"1px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"space-between",background:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:800,color:"#0f172a"},children:[e.jsx(me,{size:16,style:{color:"#3b82f6"}}),l.progressByDept]}),x.length>0&&e.jsx("div",{style:{minWidth:220},children:e.jsx(Ct,{rate:y})})]}),j?e.jsx("div",{style:{padding:60},children:e.jsx(qe,{message:l.loadingProgress})}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#f8fafc",borderBottom:"2px solid #e2e8f0"},children:[{label:l.dept,align:"left",pl:22},{label:l.status,align:"center",w:100},{label:"진행률",align:"left",w:180},{label:l.entryCount,align:"right"},{label:l.totalAmount,align:"right"},{label:"출력",align:"right",pr:22}].map(({label:p,align:a,w:g,pl:k,pr:v})=>e.jsx("th",{style:{padding:"10px 14px",...k?{paddingLeft:k}:{},...v?{paddingRight:v}:{},...g?{width:g}:{},textAlign:a,fontSize:11,fontWeight:700,color:"#64748b",letterSpacing:"0.04em",whiteSpace:"nowrap"},children:p},p))})}),e.jsx("tbody",{children:W.length?W.map((p,a)=>{const g=p.dept,k=se[g.dept_status]||se.NOT_STARTED,v=g.aggregatedBarPct??0,F=R[g.org_id],z=p.teams.length>0;return e.jsxs(Re.Fragment,{children:[e.jsxs("tr",{style:{background:a%2===0?"#fff":"#fafbfc",borderBottom:"1px solid #f1f5f9",cursor:z?"pointer":"default",transition:"background 0.12s"},onMouseEnter:S=>{S.currentTarget.style.background="#f0f4ff"},onMouseLeave:S=>{S.currentTarget.style.background=a%2===0?"#fff":"#fafbfc"},onClick:()=>z&&B(g.org_id),children:[e.jsx("td",{style:{padding:"11px 14px",paddingLeft:22,fontWeight:700,color:"#0f172a",fontSize:13},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7},children:[z?F?e.jsx(Qe,{size:13,style:{color:"#64748b",flexShrink:0}}):e.jsx(st,{size:13,style:{color:"#64748b",flexShrink:0}}):e.jsx("div",{style:{width:13}}),g.org_name||"-",z&&e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:"#94a3b8",background:"#f1f5f9",borderRadius:4,padding:"1px 5px"},children:[p.teams.length,"팀"]})]})}),e.jsx("td",{style:{padding:"11px 14px",textAlign:"center"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:11,fontWeight:700,padding:"3px 9px",borderRadius:999,background:k.bg,color:k.color,border:`1px solid ${k.border}`},children:[e.jsx("span",{style:{width:5,height:5,borderRadius:"50%",background:k.barColor,display:"inline-block"}}),k.label]})}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{flex:1,height:7,borderRadius:99,background:"#f1f5f9",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:g.dept_status==="COMPLETED"?"linear-gradient(90deg,#10b981,#059669)":`linear-gradient(90deg,${k.barColor}99,${k.barColor})`,width:`${v}%`,transition:"width 0.4s"}})}),e.jsxs("span",{style:{fontSize:11,fontWeight:800,color:k.color,minWidth:34,textAlign:"right"},children:[v,"%"]})]})}),e.jsx("td",{style:{padding:"11px 14px",textAlign:"right",fontSize:13,color:"#334155",fontVariantNumeric:"tabular-nums"},children:Number(g.total_entries||0).toLocaleString()}),e.jsx("td",{style:{padding:"11px 14px",textAlign:"right",fontSize:13,fontWeight:700,color:"#0f172a",fontVariantNumeric:"tabular-nums"},children:Number(g.total_amount||0).toLocaleString()}),e.jsx("td",{style:{padding:"11px 14px",paddingRight:22,textAlign:"right"},children:e.jsxs("button",{onClick:S=>{S.stopPropagation(),H(g.org_id)},style:{display:"inline-flex",alignItems:"center",gap:5,fontSize:11,fontWeight:700,padding:"5px 12px",borderRadius:7,background:"#fff",border:"1px solid #e2e8f0",color:"#334155",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:S=>{S.currentTarget.style.borderColor="#2563eb",S.currentTarget.style.color="#2563eb"},onMouseLeave:S=>{S.currentTarget.style.borderColor="#e2e8f0",S.currentTarget.style.color="#334155"},children:[e.jsx(je,{size:12})," 예산서"]})})]}),F&&p.teams.map(S=>{const O=se[S.dept_status]||se.NOT_STARTED,T=Number(S.total_entries||0),A=Number(S.status_counts?.FINALIZED||0),N=T>0?Math.round(A/T*100):0;return e.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"9px 14px 9px 44px",color:"#475569",fontSize:12},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{color:"#cbd5e1"},children:"└"}),S.org_name||"-"]})}),e.jsx("td",{style:{padding:"9px 14px",textAlign:"center"},children:e.jsx("span",{style:{display:"inline-block",fontSize:10,fontWeight:700,padding:"2px 7px",borderRadius:999,background:O.bg,color:O.color,border:`1px solid ${O.border}`},children:O.label})}),e.jsx("td",{style:{padding:"9px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{flex:1,height:5,borderRadius:99,background:"#e2e8f0",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:99,background:O.barColor,width:`${N}%`}})}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,color:O.color,minWidth:34,textAlign:"right"},children:[N,"%"]})]})}),e.jsx("td",{style:{padding:"9px 14px",textAlign:"right",fontSize:12,color:"#475569",fontVariantNumeric:"tabular-nums"},children:T.toLocaleString()}),e.jsx("td",{style:{padding:"9px 14px",textAlign:"right",fontSize:12,fontWeight:600,color:"#334155",fontVariantNumeric:"tabular-nums"},children:Number(S.total_amount||0).toLocaleString()}),e.jsx("td",{})]},S.org_id)})]},a)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{padding:32,textAlign:"center",color:"#94a3b8",fontSize:13},children:l.noProgressData})})})]})]})]})}const{simpleLabel:Z,simpleInput:oe,simpleSelect:Ce,simpleTextarea:Rt}=ue;function ve({data:t,setData:o,currentFileUrl:s,isCreate:_=!1,fileInputId:x,transferSourceOptions:j}){const[L,f]=c.useState(t.name||""),[P,M]=c.useState(t.guidelines||"");c.useEffect(()=>{queueMicrotask(()=>{f(t.name||"")})},[t.name]),c.useEffect(()=>{queueMicrotask(()=>{M(t.guidelines||"")})},[t.guidelines]);const m=(i,y)=>{o(w=>({...w,[i]:y}))};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24,padding:"10px 0"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Z,margin:0},children:l.applyYear}),e.jsx("input",{type:"number",style:{...oe,borderRadius:10},value:t.year,onChange:i=>{const y=parseInt(i.target.value);o(w=>({...w,year:y}))}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Z,margin:0},children:l.roundName}),e.jsx("input",{style:{...oe,borderRadius:10},placeholder:l.namePlaceholder,value:L,onChange:i=>{const y=i.target.value;f(y)},onCompositionEnd:i=>{m("name",i.currentTarget.value)},onBlur:i=>{m("name",i.target.value)}})]}),_&&e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",paddingTop:20,display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Z,margin:0},children:l.createMode}),e.jsxs("select",{style:{...Ce,borderRadius:10},value:t.creation_mode||"NEW",onChange:i=>{const y=i.target.value;o(w=>({...w,creation_mode:y,source_version_id:y==="TRANSFER"?w.source_version_id:""}))},children:[e.jsx("option",{value:"NEW",children:l.newCreate}),e.jsx("option",{value:"TRANSFER",children:l.copyRound})]})]}),t.creation_mode==="TRANSFER"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:16,alignItems:"center"},children:[e.jsx("label",{style:{...Z,margin:0},children:l.originalRound}),e.jsxs("select",{style:{...Ce,borderRadius:10},value:t.source_version_id||"",onChange:i=>{const y=i.target.value;o(w=>({...w,source_version_id:y}))},children:[e.jsx("option",{value:"",children:l.selectOriginal}),j.map(i=>e.jsxs("option",{value:i.id,children:[i.year," ",i.name," (",i.round??0,"차)"]},i.id))]})]}),t.creation_mode==="TRANSFER"&&e.jsx("div",{style:{fontSize:12,color:"#64748b",paddingLeft:116},children:l.copyNotice})]}),e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",paddingTop:20},children:[e.jsx("label",{style:{...Z,marginBottom:8,display:"block"},children:l.periodSetting}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("input",{type:"date",style:{...oe,borderRadius:10,flex:1},value:t.start_date,onChange:i=>{const y=i.target.value;o(w=>({...w,start_date:y}))}}),e.jsx("span",{style:{color:"#94a3b8"},children:"~"}),e.jsx("input",{type:"date",style:{...oe,borderRadius:10,flex:1},value:t.end_date,onChange:i=>{const y=i.target.value;o(w=>({...w,end_date:y}))}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Z,marginBottom:8,display:"block"},children:l.guidelinesLabel}),e.jsx("textarea",{style:{...Rt,height:120,borderRadius:12,padding:16},value:P,onChange:i=>{const y=i.target.value;M(y)},onCompositionEnd:i=>{m("guidelines",i.currentTarget.value)},onBlur:i=>{m("guidelines",i.target.value)},placeholder:l.guidelinesPlaceholder})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Z,marginBottom:8,display:"block"},children:l.fileUploadLabel}),e.jsxs("div",{style:{border:"2px dashed #e2e8f0",borderRadius:12,padding:"20px",textAlign:"center",cursor:"pointer",transition:"all 0.2s",position:"relative"},onClick:()=>document.getElementById(x).click(),children:[e.jsx(et,{size:24,color:"#94a3b8",style:{marginBottom:8}}),e.jsx("div",{style:{fontSize:13,color:"#64748b"},children:t.file?t.file.name:s?`${l.currentFile}${s.split("/").pop()}`:l.uploadPlaceholder}),e.jsx("input",{id:x,type:"file",style:{display:"none"},onChange:i=>{const y=i.target.files[0];o(w=>({...w,file:y}))}}),(t.file||s)&&e.jsx("button",{type:"button",style:{position:"absolute",top:10,right:10,background:"none",border:"none",cursor:"pointer",color:"#ef4444"},onClick:i=>{i.stopPropagation(),o(y=>({...y,file:null}))},title:l.removeFile,children:e.jsx(le,{size:16})})]})]})]})}function $t({menuId:t,authAxios:o,version:s,versions:_,setVersion:x,onBootstrap:j,user:L,modalApi:f,initialUrlParams:P={}}){const M=()=>({year:new Date().getFullYear(),name:"",start_date:"",end_date:"",guidelines:"",file:null,creation_mode:"NEW",source_version_id:""}),[m,i]=c.useState(()=>P.versionId?"detail":"list"),[y,w]=c.useState({}),[,R]=c.useState(null),[E,B]=c.useState([]),[I,D]=c.useState(!1),[W,H]=c.useState(null),[p,a]=c.useState(!1),[g,k]=c.useState(!1),[v,F]=c.useState(null),[z,S]=c.useState(""),O=c.useRef(null),[T,A]=c.useState(M()),[N,$]=c.useState({year:"",name:"",start_date:"",end_date:"",guidelines:""}),[n,u]=c.useState(!1),[h,b]=c.useState(""),[,J]=c.useState(null),xe=L?.role==="ADMIN",Q=c.useCallback(async r=>{const d=r||s?.id;if(d){D(!0);try{const C=await o.get(`/api/versions/${d}/progress/`);B(C.data)}catch(C){console.error(C)}finally{D(!1)}}},[o,s?.id]);c.useEffect(()=>{const r={};_.forEach(d=>{r[d.id]=d.status}),w(r)},[_]),c.useEffect(()=>{if(m==="list"){const r=_.find(d=>["PENDING","DRAFT","EXPIRED"].includes(d.status));r&&r.id!==W&&(H(r.id),Q(r.id))}},[m,_,W,Q]),c.useEffect(()=>{s&&s.id&&(m==="detail"&&Q(s.id),$({year:s.year,name:s.name,start_date:s.start_date||"",end_date:s.end_date||"",guidelines:s.guidelines||""}))},[s,m,Q]);const ge=c.useRef(!1);c.useEffect(()=>{if(ge.current||!_.length)return;const r=P.versionId;if(!r)return;const d=_.find(C=>C.id===r);d&&(x(d),i("detail")),ge.current=!0},[_,P.versionId,x]),c.useEffect(()=>{if(m==="detail"&&s?.id){const r=`/intake/versions/${s.id}`;window.location.pathname!==r&&window.history.pushState({},"",r)}else m==="list"&&window.location.pathname!=="/intake"&&window.history.pushState({},"","/intake")},[m,s?.id]);const ze=c.useMemo(()=>[..._].sort((r,d)=>d.year-r.year||d.round-r.round),[_]),Ne=async r=>{if(await f.confirm(l.confirmDelete(r.name)))try{await o.delete(`/api/versions/${r.id}/`),await j(),await f.alert(l.deleteSuccess)}catch(d){if(d.response?.status===409&&d.response?.data?.can_force){const C=d.response.data.entry_count;S(""),F({version:r,entryCount:C}),setTimeout(()=>O.current?.focus(),80)}else await f.alert(U(d,l.deleteFail))}},he=async()=>{if(v)try{await o.delete(`/api/versions/${v.version.id}/force-delete/`),F(null),await j(),await f.alert(l.deleteSuccess)}catch(r){await f.alert(U(r,l.deleteFail))}},be=async r=>{if(await f.confirm(l.confirmClose(r.name)))try{await o.post(`/api/versions/${r.id}/close/`),await j(),await f.alert(l.closeSuccess)}catch(d){await f.alert(U(d,l.closeFail))}},ye=async r=>{if(await f.confirm(l.confirmReopen(r.name)))try{await o.post(`/api/versions/${r.id}/reopen/`),await j(),await f.alert(l.reopenSuccess)}catch(d){await f.alert(U(d,l.reopenFail))}},Me=async()=>{try{if(T.creation_mode==="TRANSFER"&&!T.source_version_id){await f.alert(l.transferRequired);return}const r=new FormData;r.append("year",T.year),r.append("name",T.name||l.newRoundName(T.year)),r.append("start_date",T.start_date),r.append("end_date",T.end_date),r.append("guidelines",T.guidelines),r.append("creation_mode",T.creation_mode||"NEW"),r.append("base_data_mode",(T.creation_mode||"NEW")==="TRANSFER"?"IMPORT_PREVIOUS":"NEW"),T.source_version_id&&(r.append("source_version_id",T.source_version_id),r.append("base_version_id",T.source_version_id)),T.file&&r.append("guidelines_file",T.file);const d=await o.post("/api/versions/create_next_round/",r,{headers:{"Content-Type":"multipart/form-data"}});await j(),a(!1),A(M());const C=Number(d?.data?.cloned_count||0);await f.alert(l.createSuccess(C))}catch(r){const C=r?.response?.data?.error==="source version has no entries"?l.sourceVersionEmpty:U(r,l.createFail);await f.alert(C)}},We=async r=>{const d=y[r.id];if(!(!d||d===r.status)){R(r.id);try{await o.patch(`/api/versions/${r.id}/`,{status:d,confirmed_at:d==="CONFIRMED"?new Date().toISOString():null}),await j(),await f.alert(l.updateSuccess)}catch(C){await f.alert(U(C,l.updateFail))}finally{R(null)}}},$e=async()=>{if(s)try{const r=new FormData;r.append("year",N.year),r.append("name",N.name),r.append("start_date",N.start_date),r.append("end_date",N.end_date),r.append("guidelines",N.guidelines),N.file?r.append("guidelines_file",N.file):N.file===null&&s.guidelines_file&&r.append("guidelines_file","");const d=await o.patch(`/api/versions/${s.id}/`,r,{headers:{"Content-Type":"multipart/form-data"}});x(d.data),await j(),k(!1),$({year:"",name:"",start_date:"",end_date:"",guidelines:"",file:null}),await f.alert(l.saveSuccess)}catch(r){await f.alert(U(r,l.saveFail))}},Le=async()=>{if(!h.trim())return f.alert(l.inputRequired);try{const d=h.trim().split(`
`).map(G=>{const[Y,X,re,K,Ue]=G.split(",").map(Ae=>Ae.trim());return{subject_code:Y,org_code:X,details:[{name:re,price:parseInt(K)||0,qty:parseFloat(Ue)||0,freq:1,source:"자체"}]}}).filter(G=>G.subject_code&&G.org_code),C=await o.post("/api/entries/bulk-upsert/",{year:s.year,round:s.round||0,entries:d});J(C.data),await j(),b(""),await f.alert(l.uploadSuccess(C.data.created,C.data.updated)),Q(s.id)}catch(r){await f.alert(U(r,l.uploadFail))}},Fe=async r=>{if(r?.length&&await f.confirm(`선택한 ${r.length}개의 예산서를 삭제하시겠습니까?`))try{const d=await o.post("/api/versions/bulk-delete/",{ids:r}),C=d.data.deleted_ids?.length||0,G=d.data.errors?.length||0;if(await j(),G>0){const Y=d.data.errors.filter(X=>X.entry_count>0);Y.length>0?await f.confirm(`${Y.length}개의 예산서에 기존 데이터가 존재합니다. 강제로 삭제하시겠습니까?`)&&(await o.post("/api/versions/bulk-delete/",{ids:Y.map(X=>X.id),force:!0}),await j(),await f.alert("강제 삭제가 완료되었습니다.")):await f.alert(`${C}개 삭제 성공, ${G}개 실패.`)}else await f.alert(`${C}개의 예산서가 삭제되었습니다.`)}catch(d){await f.alert(U(d,"일괄 삭제에 실패했습니다."))}},Pe=async(r,d)=>{if(r?.length)try{await o.post("/api/versions/bulk-update-status/",{ids:r,status:d}),await j(),await f.alert("상태 변경이 완료되었습니다.")}catch(C){await f.alert(U(C,"상태 변경에 실패했습니다."))}},Be=r=>{x(r),i("detail")},Oe=async()=>{if(s?.id)try{const r=await o.get(`/api/versions/${s.id}/export-budget-book/`,{responseType:"blob"}),C=(r.headers?.["content-disposition"]||"").match(/filename\*=UTF-8''([^;]+)/i),G=`budget_book_${s.year}_r${s.round}.xlsx`,Y=C?decodeURIComponent(C[1]):G,X=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),re=window.URL.createObjectURL(X),K=document.createElement("a");K.href=re,K.download=Y,document.body.appendChild(K),K.click(),K.remove(),window.URL.revokeObjectURL(re),await f.alert(l.exportOfficialBookDone)}catch(r){await f.alert(U(r,l.exportOfficialBookFail))}};return e.jsxs(He,{menuId:t,user:L,breadcrumbs:m==="detail"?[{label:l.pageTitle,onClick:()=>i("list")},{label:l.listTitle,onClick:()=>i("list")},`${l.detailTitle} (${s?.name||""})`]:[l.pageTitle,l.listTitle],contextBadge:s?`${s.year}년 ${s.name}`:"",hideHero:!0,children:[e.jsx("div",{style:{padding:"0 20px 40px 20px"},children:m==="list"?e.jsx(St,{versions:_,version:s,setVersion:x,setViewMode:i,canManage:xe,statusById:y,setStatusById:w,saveVersionStatus:We,handleGoDetail:Be,setIsEditModalOpen:k,handleCloseVersion:be,handleReopenVersion:ye,handleDeleteVersion:Ne,setIsCreateModalOpen:a,progressData:E,summaryVersionId:W,handleBatchDelete:Fe,handleBatchUpdateStatus:Pe}):e.jsx(vt,{version:s,canManage:xe,setViewMode:i,fetchProgress:Q,progressData:E,loadingProgress:I,setIsEditModalOpen:k,handleBulkUpload:Le,csvContent:h,setCsvContent:b,isBulkExpanded:n,setIsBulkExpanded:u,onExportBudgetBook:Oe,onClose:be,onReopen:ye})}),e.jsxs(ke,{isOpen:p,onClose:()=>a(!1),title:l.newRoundBtn,width:600,children:[e.jsx(ve,{data:T,setData:A,isCreate:!0,fileInputId:"version-file-input-create",transferSourceOptions:ze}),e.jsx("div",{style:{paddingTop:20,borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",marginTop:10},children:e.jsx("button",{type:"button",style:{background:"#2563eb",color:"#fff",border:"none",padding:"12px 32px",borderRadius:12,fontWeight:800,cursor:"pointer",boxShadow:"0 4px 6px -1px rgba(37,99,235,0.2)"},onClick:Me,children:l.newRoundBtn})})]}),e.jsxs(ke,{isOpen:g,onClose:()=>k(!1),title:l.editRoundBtn,width:600,children:[e.jsx(ve,{data:N,setData:$,currentFileUrl:s?.guidelines_file,fileInputId:"version-file-input-edit"}),e.jsx("div",{style:{paddingTop:20,borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",marginTop:10},children:e.jsx("button",{type:"button",style:{background:"#10b981",color:"#fff",border:"none",padding:"12px 32px",borderRadius:12,fontWeight:800,cursor:"pointer",boxShadow:"0 4px 6px -1px rgba(16,185,129,0.2)"},onClick:$e,children:l.save})})]}),v&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(15,23,42,0.55)",backdropFilter:"blur(3px)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:20,width:480,maxWidth:"90vw",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.35)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",padding:"20px 24px",display:"flex",alignItems:"center",gap:12},children:[e.jsx(Xe,{size:22,color:"#fff"}),e.jsx("span",{style:{color:"#fff",fontWeight:800,fontSize:17},children:"예산서 강제 삭제"})]}),e.jsxs("div",{style:{padding:"24px 24px 20px"},children:[e.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fca5a5",borderRadius:12,padding:"14px 16px",marginBottom:20},children:[e.jsx("p",{style:{margin:0,fontWeight:700,color:"#b91c1c",fontSize:14,marginBottom:6},children:"⚠ 이 작업은 되돌릴 수 없습니다"}),e.jsxs("p",{style:{margin:0,color:"#7f1d1d",fontSize:13,lineHeight:1.6},children:[e.jsxs("strong",{children:['"',v.version.name,'"']})," 예산서와 연결된"," ",e.jsxs("strong",{children:["예산 항목 ",v.entryCount.toLocaleString(),"건"]}),"이 모두 영구 삭제됩니다."]})]}),e.jsxs("p",{style:{margin:"0 0 10px",fontSize:13,color:"#475569",fontWeight:600},children:["계속하려면 아래 입력란에 ",e.jsx("code",{style:{background:"#f1f5f9",padding:"2px 7px",borderRadius:5,fontFamily:"monospace",fontWeight:800,color:"#dc2626",fontSize:13},children:"DELETE"})," 를 입력하세요."]}),e.jsx("input",{ref:O,type:"text",value:z,onChange:r=>S(r.target.value),onKeyDown:r=>{r.key==="Enter"&&z==="DELETE"&&he()},placeholder:"DELETE",style:{width:"100%",boxSizing:"border-box",border:`2px solid ${z==="DELETE"?"#dc2626":"#e2e8f0"}`,borderRadius:10,padding:"10px 14px",fontSize:15,fontWeight:700,fontFamily:"monospace",outline:"none",color:"#0f172a",transition:"border-color 0.2s"}})]}),e.jsxs("div",{style:{padding:"0 24px 24px",display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>{F(null),S("")},style:{padding:"10px 22px",borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",color:"#475569",fontWeight:700,cursor:"pointer",fontSize:14},children:"취소"}),e.jsx("button",{type:"button",disabled:z!=="DELETE",onClick:he,style:{padding:"10px 22px",borderRadius:10,border:"none",background:z==="DELETE"?"#dc2626":"#fca5a5",color:"#fff",fontWeight:800,fontSize:14,cursor:z==="DELETE"?"pointer":"not-allowed",transition:"background 0.2s",boxShadow:z==="DELETE"?"0 4px 6px -1px rgba(220,38,38,0.3)":"none"},children:"강제 삭제"})]})]})})]})}export{$t as default};
