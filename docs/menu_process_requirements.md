# IBMS 메뉴별 프로세스/결정사항/요구조건 정의

## 1. 목적
- 본 문서는 IBMS의 메뉴별 업무 흐름을 표준화하고, 구현 전 필수 의사결정과 요구사항을 확정하기 위한 기준 문서다.
- 범위는 프론트 메뉴 구조, 상태 전이, 권한 통제, 출력(Excel), 감사 추적을 포함한다.

## 2. 공통 운영 원칙
1. 예산 회차는 `본예산`, `N차 추경`, `정리추경` 형식으로 운영한다.
2. 상태 전이는 아래 표준 워크플로우를 따른다.
3. `최종확정(FINALIZED)` 이후 해당 회차 데이터는 수정 불가다.
4. 확정 이후 변경은 기존 회차 수정이 아니라 다음 추경 회차에서만 처리한다.
5. 모든 변경/승인/권한 변경은 감사로그를 남긴다.

## 3. 표준 상태 모델
| 상태코드 | 상태명 | 설명 | 수정 가능 여부 |
|---|---|---|---|
| DRAFT | 작성중 | 부서 담당자 편성 입력 단계 | 가능 |
| PENDING | 부서상신 | 담당자 -> 부서 승인권자 상신 | 제한적 |
| REVIEWING | 부서승인 | 부서 승인권자 검토/승인 단계 | 제한적 |
| HQ_REVIEW | 총무검토 | 총무팀 최종 검토 단계 | 불가(총무 코멘트만) |
| FINALIZED | 최종확정 | 총무팀 확정 완료 | 불가 |
| ANNOUNCED | 공지완료 | 전사 공지/배포 완료 | 불가 |
| CLOSED | 마감 | 회차 마감 완료 | 불가 |

## 4. 권한 역할 정의
| 역할코드 | 역할명 | 핵심 권한 |
|---|---|---|
| SYS_ADMIN | 시스템관리자 | 사용자/권한, 정책 설정, 감사로그 열람 |
| HQ_MANAGER | 총무팀(매니저) | 회차 생성/오픈/마감, 총무 검토, 최종확정, 공지 |
| DEPT_EDITOR | 부서담당자 | 소속 부서 예산 작성/수정/상신 |
| DEPT_APPROVER | 부서승인자(팀장/매니저) | 소속 부서 상신안 승인/반려 |
| ORG_VIEWER | 열람자/경영진 | 확정본 조회, 보고서 다운로드 |

## 5. 메뉴별 정의

### 5.1 대시보드
- 프로세스
1. 기준 회차 선택
2. 부서 진행률/승인 대기/지연 현황 조회
3. 필요한 메뉴로 드릴다운 이동

- 결정사항
1. 기본 진입 회차: 최신 오픈 회차
2. 지연 기준: `마감일 - 현재일` 기반 임계치 설정

- 요구조건
1. 회차별 진행률 카드
2. 승인 대기 건수 및 지연 부서 리스트
3. 공지 여부 및 최근 확정 이력 표시

- 수용기준
1. 회차 변경 시 2초 이내 대시보드 집계 갱신
2. 카드 클릭 시 대상 메뉴로 이동

### 5.2 예산 접수(회차) 관리
- 프로세스
1. 회차 생성(`본예산/추경/정리추경`)
2. 접수 기간 설정
3. 접수 시작/마감
4. 최종확정 가능 상태 전환

- 결정사항
1. 회차 코드 규칙: 예) `2026-B0`, `2026-S1`, `2026-S2`, `2026-F`
2. 동일 연도 내 회차 중복 생성 허용 여부(기본: 불가)

- 요구조건
1. 회차 생성 시 중복 검증
2. 접수기간(`start_date`, `end_date`) 필수
3. 상태 전환 이력(전환자/시각/사유) 저장

- 수용기준
1. 접수 마감 이후 부서 편성 수정 API 차단
2. 회차 상태 변경 이벤트 감사로그 적재

### 5.3 예산 편성/관리
- 프로세스
1. 부서담당자가 사업/계정체계 기준으로 금액 및 산출근거 입력
2. 임시저장/검증
3. 부서 상신

- 결정사항
1. 편성 최소 단위: 목(Level 4) 또는 산출내역 라인
2. 필수 입력: 금액, 산출근거, 담당 부서

- 요구조건
1. 계층 합계 자동 계산
2. 입력 검증(음수, 비정상 문자, 필수값 누락)
3. 상신 전 검증 실패 항목 하이라이트
4. 부서 범위 접근 제한(Row-level)

- 수용기준
1. 합계값은 화면/다운로드 결과가 동일해야 함
2. 타 부서 데이터는 조회/수정 불가

### 5.4 부서 승인함
- 프로세스
1. 승인권자가 상신 건 조회
2. 승인 또는 반려 처리
3. 반려 시 작성중으로 반환, 코멘트 전달

- 결정사항
1. 반려 사유 입력 필수 여부(권장: 필수)
2. 일괄 승인 허용 범위(동일 회차/동일 부서)

- 요구조건
1. 승인 대기 목록 필터(부서, 회차, 상태)
2. 승인/반려 이력 저장
3. 반려 코멘트 템플릿 제공

- 수용기준
1. 승인 처리 시 상태 `PENDING -> REVIEWING`
2. 반려 처리 시 상태 `PENDING -> DRAFT`

### 5.5 총무 검토/최종확정
- 프로세스
1. 부서 승인 완료건 수신
2. 총무 검토
3. 최종확정 또는 반려
4. 확정 시 잠금 및 공지 대기

- 결정사항
1. 최종확정 승인 방식: 단독 승인 vs 이중 승인
2. 확정 해제 가능 정책(예외 승인 필요 여부)

- 요구조건
1. 검토 체크리스트(누락/중복/예산총액)
2. 최종확정 시 데이터 잠금
3. 확정자/확정시각/근거 기록

- 수용기준
1. 확정 후 수정 요청 시 API 레벨 403 반환
2. 확정 이벤트는 감사로그에 상세 저장

### 5.6 확정 공지/배포
- 프로세스
1. 확정 회차 공지 작성
2. 대상자(전사/부서) 지정
3. 공지 발송 및 열람 추적

- 결정사항
1. 배포 채널: 앱 알림/메일 병행 여부
2. 재공지 정책(최대 횟수, 대상 조건)

- 요구조건
1. 공지 템플릿 관리
2. 읽음/미읽음 추적
3. 공지 버전 이력 저장

- 수용기준
1. 공지 후 5분 내 전체 대상에게 노출
2. 미열람자 재발송 기능 제공

### 5.7 마감 현황
- 프로세스
1. 부서별 완료율 집계
2. 미완료 부서 확인 및 후속 조치
3. 회차 마감 처리

- 결정사항
1. 마감 조건: 부서 100% 완료 필수 여부
2. 지연 사유 코드 체계

- 요구조건
1. 부서별 상태판(완료/진행중/지연)
2. 마감 승인자 기록
3. 재오픈 요청 워크플로우

- 수용기준
1. 마감 완료 시 상태 `ANNOUNCED -> CLOSED`
2. 재오픈은 권한자만 가능

### 5.8 보고서/Excel 출력
- 프로세스
1. 회차/부서/구분 선택
2. 보고서 생성
3. Excel 다운로드

- 결정사항
1. 공식 출력물 종류 확정
2. 숫자/서식 표준(천단위 구분, 합계행, 시트명)

- 요구조건
1. 출력 포맷 `.xlsx`
2. 기본 산출물:
3. 전사 총괄표
4. 부서별 상세표
5. 본예산 vs 추경 증감표
6. 승인/반려 이력표
7. 다운로드 이력 저장(사용자, 시각, 조건)

- 수용기준
1. 화면 수치와 Excel 수치 일치
2. 5만 행 기준 생성 실패 없이 완료

### 5.9 사용자/권한 관리
- 프로세스
1. 사용자 생성
2. 부서/역할 부여
3. 활성/잠금 및 권한 변경

- 결정사항
1. 역할 커스터마이징 허용 범위
2. 승인권자 대리 지정 정책

- 요구조건
1. 메뉴 접근 제어
2. 데이터 범위 제어(부서 단위)
3. 권한 변경 이력 저장

- 수용기준
1. 권한 없는 메뉴 접근 시 차단
2. 권한 변경 즉시 반영

### 5.10 기준정보 관리
- 프로세스
1. 부서/사업/계정체계 등록
2. 수정/비활성 처리
3. 회차 적용

- 결정사항
1. 기준정보 회차별 스냅샷 보관 여부(권장: 보관)
2. 사용중 코드 삭제 정책(권장: 비활성만 허용)

- 요구조건
1. 코드 중복 금지
2. 계층 무결성 검증(장/관/항/목)
3. 사용중 참조 데이터 보호

- 수용기준
1. 무결성 위반 시 저장 차단
2. 변경 이력 조회 가능

### 5.11 감사로그
- 프로세스
1. 이벤트 수집(변경/승인/권한)
2. 조건 검색
3. 내보내기

- 결정사항
1. 보관 기간(권장: 5년 이상)
2. 개인정보 마스킹 범위

- 요구조건
1. 필수 기록 필드: 사용자, 시각, 대상, 작업, 변경 전/후
2. 추적 ID(trace_id) 연동
3. Excel 추출 제공

- 수용기준
1. 중요 이벤트 누락률 0%
2. 조건 검색(기간/사용자/메뉴/대상) 지원

## 6. 우선 확정이 필요한 의사결정(Top 6)
1. 상태 전이 규칙 확정(반려/재상신/재오픈 포함)
2. 최종확정 승인 정책(단독/이중 승인)
3. 회차 코드 및 명명 규칙
4. 편성 최소 단위 및 필수 입력 항목
5. 마감 조건(전 부서 완료 필수 여부)
6. Excel 공식 서식 목록

## 7. 다음 산출물(후속 문서)
1. API 명세서: 엔드포인트, 요청/응답, 권한 매핑
2. DB 명세서: 상태코드, 이력 테이블, 인덱스 전략
3. 화면 상세 명세서: 메뉴별 컴포넌트/검증/예외 처리
