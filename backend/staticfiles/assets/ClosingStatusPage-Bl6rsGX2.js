import{a as y,j as e,M as D,m as $,h as z}from"./index-jKD0RYeX.js";const{menuPanelCard:S,menuPanelHead:w,menuPanelBody:F,simpleTable:P,simpleTh:h,simpleTd:u}=$;function v({menuId:b,authAxios:I,version:s,orgs:n,entries:i,user:m,onBootstrap:M,onRefreshEntries:N,modalApi:r}){const x=y.useMemo(()=>n.filter(t=>t.org_type!=="team"&&!t.parent),[n]),g=y.useMemo(()=>x.map(t=>{const d=n.filter(a=>Number(a.parent)===Number(t.id)).map(a=>Number(a.id)),C=[Number(t.id),...d],j=i.filter(a=>C.includes(Number(a.organization))),o=j.length,p=j.filter(a=>a.status==="FINALIZED").length;return{dept:t,total:o,finalized:p,ratio:o?Math.round(p/o*100):0}}),[x,n,i]),l=i.length,c=i.filter(t=>t.status==="FINALIZED").length,f=l>0&&l===c&&m?.role==="ADMIN",E=async()=>{if(!(!s||!await r.confirm("현재 회차를 확정(마감) 처리하시겠습니까?")))try{await I.patch(`/api/versions/${s.id}/`,{status:"CONFIRMED",confirmed_at:new Date().toISOString()}),await M(),await N(),await r.alert("회차가 CONFIRMED 상태로 전환되었습니다.")}catch(d){await r.alert(z(d,"회차 마감 처리에 실패했습니다."))}};return e.jsx(D,{menuId:b,user:m,actions:[{label:"회차 마감 처리",onClick:E,disabled:!f}],stats:[{label:"현재 회차",value:s?`${s.year} ${s.name}`:"미선택"},{label:"확정 진행률",value:l?`${Math.round(c/l*100)}%`:"0%"},{label:"확정/전체",value:`${c}/${l}`},{label:"마감 가능",value:f?"예":"아니오"}],children:e.jsxs("section",{style:S,children:[e.jsx("div",{style:w,children:"부서별 마감 현황"}),e.jsx("div",{style:F,children:e.jsxs("table",{style:P,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:h,children:"부서"}),e.jsx("th",{style:h,children:"확정/전체"}),e.jsx("th",{style:h,children:"진행률"})]})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:u,children:t.dept.name}),e.jsxs("td",{style:u,children:[t.finalized,"/",t.total]}),e.jsxs("td",{style:u,children:[t.ratio,"%"]})]},t.dept.id))})]})})]})})}export{v as default};
